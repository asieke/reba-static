import{m as Ls,s as ye,n as q,o as Fe,r as Jt,b as Me,f as mn,h as Ws,C as Xe}from"./scheduler.CRj-FdYT.js";import{S as be,i as ve,h as x,s as D,j as C,o as E,f as k,a as N,k as U,l as v,d as z,q as w,v as H,n as re,p as ae,y as gn,H as Tn,r as _t,w as Us,e as Fn,x as qs,t as Mn,B as Vs,C as Hs,u as Ie,G as On,z as Dn}from"./index.C6ozi9ya.js";import{s as _e,e as Te,u as ie,o as Xs,m as Ze,c as Js}from"./stores.Bnxv-Xxq.js";function Nn(r,{delay:e=0,duration:t=400,easing:n=Ls}={}){const s=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:n,css:a=>`opacity: ${a*s}`}}function zs(r){let e,t,n,s,a,i,o,c="Tell us about yourself",u,h,p=`We'll get to know you and we can personalize a plan for your finances, family, and goals.
					This should take only 5-10 minutes.`,_,m,f="Take the Quiz",g,S,A=`<p>Investment advisory services provided through Fidelity Personal and Workplace Advisors LLC,
				a registered investment adviser, for a fee. Brokerage services provided through Fidelity
				Brokerage Services LLC, Member NYSE, SIPC. Both are Fidelity Investments companies. The
				images, graphs, tools, and videos are for illustrative purposes only.</p> <p>Fidelity Brokerage Services LLC, Member NYSE, SIPC, 900 Salem Street, Smithfield, RI</p> <p>02917 782377.109.0</p>`,l,d;return{c(){e=x("div"),t=x("div"),n=D(),s=x("div"),a=x("div"),i=x("div"),o=x("h1"),o.textContent=c,u=D(),h=x("p"),h.textContent=p,_=D(),m=x("button"),m.textContent=f,g=D(),S=x("div"),S.innerHTML=A,this.h()},l(y){e=C(y,"DIV",{class:!0});var b=E(e);t=C(b,"DIV",{class:!0}),E(t).forEach(k),n=N(b),s=C(b,"DIV",{class:!0});var P=E(s);a=C(P,"DIV",{class:!0});var T=E(a);i=C(T,"DIV",{class:!0});var O=E(i);o=C(O,"H1",{class:!0,"data-svelte-h":!0}),U(o)!=="svelte-1lc6bui"&&(o.textContent=c),u=N(O),h=C(O,"P",{class:!0,"data-svelte-h":!0}),U(h)!=="svelte-ssohfm"&&(h.textContent=p),_=N(O),m=C(O,"BUTTON",{class:!0,"data-svelte-h":!0}),U(m)!=="svelte-1tinlz"&&(m.textContent=f),O.forEach(k),T.forEach(k),g=N(P),S=C(P,"DIV",{class:!0,"data-svelte-h":!0}),U(S)!=="svelte-3n41qz"&&(S.innerHTML=A),P.forEach(k),b.forEach(k),this.h()},h(){v(t,"class","min-h-[calc(100vh-112px)] picture svelte-xyzp20"),v(o,"class","font-light"),v(h,"class","my-4 font-light text-sm text-fidelity-neutral-600"),v(m,"class","bg-fidelity-green-600 text-white svelte-xyzp20"),v(i,"class","w-80"),v(a,"class","flex h-[calc(100%-150px)] items-center justify-center"),v(S,"class","h-[150px] text-[9px] p-8 space-y-3 text-fidelity-neutral-500"),v(s,"class","flex flex-col"),v(e,"class","grid grid-cols-2 w-full")},m(y,b){z(y,e,b),w(e,t),w(e,n),w(e,s),w(s,a),w(a,i),w(i,o),w(i,u),w(i,h),w(i,_),w(i,m),w(s,g),w(s,S),l||(d=H(m,"click",r[3]),l=!0)},p:q,i:q,o:q,d(y){y&&k(e),l=!1,d()}}}function Gs(r,e,t){let{back:n}=e,{next:s}=e,{changeStep:a=o=>{}}=e;Fe(()=>{console.log(n),_e.set(!1)});const i=()=>a(s);return r.$$set=o=>{"back"in o&&t(2,n=o.back),"next"in o&&t(0,s=o.next),"changeStep"in o&&t(1,a=o.changeStep)},[s,a,n,i]}class Gr extends be{constructor(e){super(),ve(this,e,Gs,zs,ye,{back:2,next:0,changeStep:1})}}function Bn(r,e,t){const n=r.slice();return n[10]=e[t],n[12]=t,n}function jn(r){let e,t=r[10].label+"",n,s,a,i;function o(){return r[7](r[12])}return{c(){e=x("button"),n=re(t),s=D(),this.h()},l(c){e=C(c,"BUTTON",{class:!0});var u=E(e);n=ae(u,t),s=N(u),u.forEach(k),this.h()},h(){v(e,"class","grid svelte-q9pajy"),Tn(e,"selected",r[10].status)},m(c,u){z(c,e,u),w(e,n),w(e,s),a||(i=H(e,"click",o),a=!0)},p(c,u){r=c,u&8&&t!==(t=r[10].label+"")&&_t(n,t),u&8&&Tn(e,"selected",r[10].status)},d(c){c&&k(e),a=!1,i()}}}function $s(r){let e,t,n,s,a,i,o,c="How would you like to get started today?",u,h,p="Please select anything you would like to help you with:",_,m,f,g,S,A="Back",l,d,y,b,P,T=Te(r[3]),O=[];for(let I=0;I<T.length;I+=1)O[I]=jn(Bn(r,T,I));return{c(){e=x("div"),t=x("div"),n=D(),s=x("div"),a=x("div"),i=x("div"),o=x("h1"),o.textContent=c,u=D(),h=x("p"),h.textContent=p,_=D(),m=x("div");for(let I=0;I<O.length;I+=1)O[I].c();f=D(),g=x("div"),S=x("button"),S.textContent=A,l=D(),d=x("button"),y=re("Next"),this.h()},l(I){e=C(I,"DIV",{class:!0});var G=E(e);t=C(G,"DIV",{class:!0}),E(t).forEach(k),n=N(G),s=C(G,"DIV",{class:!0});var L=E(s);a=C(L,"DIV",{class:!0});var Oe=E(a);i=C(Oe,"DIV",{class:!0});var fe=E(i);o=C(fe,"H1",{class:!0,"data-svelte-h":!0}),U(o)!=="svelte-1c1n5sv"&&(o.textContent=c),u=N(fe),h=C(fe,"P",{class:!0,"data-svelte-h":!0}),U(h)!=="svelte-9dtfsf"&&(h.textContent=p),_=N(fe),m=C(fe,"DIV",{class:!0});var En=E(m);for(let Kt=0;Kt<O.length;Kt+=1)O[Kt].l(En);En.forEach(k),f=N(fe),g=C(fe,"DIV",{class:!0});var Qe=E(g);S=C(Qe,"BUTTON",{class:!0,"data-svelte-h":!0}),U(S)!=="svelte-1admezx"&&(S.textContent=A),l=N(Qe),d=C(Qe,"BUTTON",{class:!0});var In=E(d);y=ae(In,"Next"),In.forEach(k),Qe.forEach(k),fe.forEach(k),Oe.forEach(k),L.forEach(k),G.forEach(k),this.h()},h(){v(t,"class","min-h-[calc(100vh-112px)] picture svelte-q9pajy"),v(o,"class","font-light text-center"),v(h,"class","my-4 font-light text-sm text-center text-fidelity-neutral-600"),v(m,"class","flex justify-center items-center flex-wrap gap-2"),v(S,"class","back"),v(d,"class","next"),d.disabled=r[4],v(g,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),v(i,"class","w-[80%] -mt-24"),v(a,"class","flex h-full items-center justify-center"),v(s,"class","flex flex-col"),v(e,"class","grid grid-cols-2 w-full")},m(I,G){z(I,e,G),w(e,t),w(e,n),w(e,s),w(s,a),w(a,i),w(i,o),w(i,u),w(i,h),w(i,_),w(i,m);for(let L=0;L<O.length;L+=1)O[L]&&O[L].m(m,null);w(i,f),w(i,g),w(g,S),w(g,l),w(g,d),w(d,y),b||(P=[H(S,"click",r[8]),H(d,"click",r[9])],b=!0)},p(I,[G]){if(G&40){T=Te(I[3]);let L;for(L=0;L<T.length;L+=1){const Oe=Bn(I,T,L);O[L]?O[L].p(Oe,G):(O[L]=jn(Oe),O[L].c(),O[L].m(m,null))}for(;L<O.length;L+=1)O[L].d(1);O.length=T.length}G&16&&(d.disabled=I[4])},i:q,o:q,d(I){I&&k(e),gn(O,I),b=!1,Jt(P)}}}function Ks(r,e,t){let n,s;Me(r,ie,m=>t(6,s=m)),Fe(()=>{_e.set(!1)});let{back:a}=e,{next:i}=e,{changeStep:o=m=>{}}=e,c=[{label:"Save for Retirement",status:0},{label:"Build Wealth",status:0},{label:"Save for College",status:0},{label:"Give to Charity",status:0},{label:"Create a Budget",status:0},{label:"Save for a Rainy Day",status:0},{label:"Buy a Home",status:0},{label:"Pay down Debt",status:0}].map(m=>({label:m.label,status:s.goals&&s.goals.includes(m.label)?1:0}));const u=m=>{t(3,c=c.map((f,g)=>m===g?{...f,status:f.status?0:1}:f)),ie.update(f=>(f.goals=c.filter(g=>g.status).map(g=>g.label),f))},h=m=>u(m),p=()=>o(a),_=()=>o(i);return r.$$set=m=>{"back"in m&&t(0,a=m.back),"next"in m&&t(1,i=m.next),"changeStep"in m&&t(2,o=m.changeStep)},r.$$.update=()=>{r.$$.dirty&64&&t(4,n=!s.goals||s.goals.length===0)},[a,i,o,c,n,u,s,h,p,_]}class $r extends be{constructor(e){super(),ve(this,e,Ks,$s,ye,{back:0,next:1,changeStep:2})}}function Ys(r){let e;return{c(){e=x("div")},l(t){e=C(t,"DIV",{}),E(e).forEach(k)},m(t,n){z(t,e,n)},p:q,i:q,o:q,d(t){t&&k(e)}}}function Qs(r){var h;let e,t,n,s=(((h=r[2].name)==null?void 0:h.split(" ")[0])||"")+"",a,i,o,c,u;return{c(){e=x("div"),t=x("h1"),n=re("Nice to meet you "),a=re(s),i=re("!"),this.h()},l(p){e=C(p,"DIV",{});var _=E(e);t=C(_,"H1",{class:!0});var m=E(t);n=ae(m,"Nice to meet you "),a=ae(m,s),i=ae(m,"!"),m.forEach(k),_.forEach(k),this.h()},h(){v(t,"class","my-20 text-center text-fidelity-neutral-600 font-light")},m(p,_){z(p,e,_),w(e,t),w(t,n),w(t,a),w(t,i),u=!0},p(p,_){var m;(!u||_&4)&&s!==(s=(((m=p[2].name)==null?void 0:m.split(" ")[0])||"")+"")&&_t(a,s)},i(p){u||(p&&Ws(()=>{u&&(c&&c.end(1),o=Vs(e,Nn,{duration:1e3}),o.start())}),u=!0)},o(p){o&&o.invalidate(),p&&(c=Hs(e,Nn,{duration:500})),u=!1},d(p){p&&k(e),p&&c&&c.end()}}}function Zs(r){let e,t,n="What's your name",s,a,i="We'll use this to personalize your experience",o,c,u,h,p,_="Back",m,f,g,S,A;return{c(){e=x("div"),t=x("h1"),t.textContent=n,s=D(),a=x("p"),a.textContent=i,o=D(),c=x("textarea"),u=D(),h=x("div"),p=x("button"),p.textContent=_,m=D(),f=x("button"),g=re("Next"),this.h()},l(l){e=C(l,"DIV",{class:!0});var d=E(e);t=C(d,"H1",{class:!0,"data-svelte-h":!0}),U(t)!=="svelte-1wflpqz"&&(t.textContent=n),s=N(d),a=C(d,"P",{class:!0,"data-svelte-h":!0}),U(a)!=="svelte-10g4aiz"&&(a.textContent=i),o=N(d),c=C(d,"TEXTAREA",{class:!0,rows:!0}),E(c).forEach(k),u=N(d),h=C(d,"DIV",{class:!0});var y=E(h);p=C(y,"BUTTON",{class:!0,"data-svelte-h":!0}),U(p)!=="svelte-1admezx"&&(p.textContent=_),m=N(y),f=C(y,"BUTTON",{class:!0});var b=E(f);g=ae(b,"Next"),b.forEach(k),y.forEach(k),d.forEach(k),this.h()},h(){v(t,"class","font-light"),v(a,"class","text-fidelity-neutral-500 my-3"),v(c,"class","single"),v(c,"rows","1"),v(p,"class","back"),v(f,"class","next"),f.disabled=r[5],v(h,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),v(e,"class","w-96 h-1/2 mx-auto text-center")},m(l,d){z(l,e,d),w(e,t),w(e,s),w(e,a),w(e,o),w(e,c),r[9](c),Ie(c,r[2].name),w(e,u),w(e,h),w(h,p),w(h,m),w(h,f),w(f,g),S||(A=[H(c,"input",r[10]),H(c,"keydown",r[11]),H(p,"click",r[12]),H(f,"click",r[7])],S=!0)},p(l,d){d&4&&Ie(c,l[2].name),d&32&&(f.disabled=l[5])},i:q,o:q,d(l){l&&k(e),r[9](null),S=!1,Jt(A)}}}function er(r){let e,t,n;const s=[Zs,Qs,Ys],a=[];function i(o,c){return o[4]==="form"?0:o[4]==="welcome"?1:2}return t=i(r),n=a[t]=s[t](r),{c(){e=x("div"),n.c(),this.h()},l(o){e=C(o,"DIV",{class:!0});var c=E(e);n.l(c),c.forEach(k),this.h()},h(){v(e,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(o,c){z(o,e,c),a[t].m(e,null)},p(o,[c]){let u=t;t=i(o),t===u?a[t].p(o,c):(Us(),Fn(a[u],1,1,()=>{a[u]=null}),qs(),n=a[t],n?n.p(o,c):(n=a[t]=s[t](o),n.c()),Mn(n,1),n.m(e,null))},i(o){Mn(n)},o(o){Fn(n)},d(o){o&&k(e),a[t].d()}}}function tr(r,e,t){let n,s;Me(r,ie,A=>t(2,s=A));let{back:a}=e,{next:i}=e,{changeStep:o=A=>{}}=e,c,u=!0,h="form";Fe(()=>{_e.set(!0),s.name&&(u=!1),c==null||c.focus(),window.scrollTo(0,0)});const p=A=>{A.key==="Enter"&&(A.preventDefault(),_())},_=()=>{u?(_e.set(!1),t(4,h="welcome"),setTimeout(()=>{t(4,h="")},2250),setTimeout(()=>{o(i)},2500)):o(i)};function m(A){mn[A?"unshift":"push"](()=>{c=A,t(3,c)})}function f(){s.name=this.value,ie.set(s)}const g=A=>p(A),S=()=>o(a);return r.$$set=A=>{"back"in A&&t(0,a=A.back),"next"in A&&t(8,i=A.next),"changeStep"in A&&t(1,o=A.changeStep)},r.$$.update=()=>{r.$$.dirty&4&&t(5,n=s.name?s.name.length<=4:!0)},[a,o,s,c,h,n,p,_,i,m,f,g,S]}class Kr extends be{constructor(e){super(),ve(this,e,tr,er,ye,{back:0,next:8,changeStep:1})}}const Se="4.45.0";let Ln=!1,Je,os,ls,nn,cs,us,hs,ds,fs;function nr(r,e={auto:!1}){if(Ln)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Je)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Je}'\``);Ln=e.auto,Je=r.kind,os=r.fetch,ls=r.FormData,nn=r.File,cs=r.ReadableStream,us=r.getMultipartRequestOptions,hs=r.getDefaultAgent,ds=r.fileFromPath,fs=r.isFsReadStream}class sr{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function rr({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,a;try{t=fetch,n=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new sr(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}Je||nr(rr(),{auto:!0});class M extends Error{}class X extends M{constructor(e,t,n,s){super(`${X.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"];const a=t;this.error=a,this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e)return new zt({cause:rn(t)});const a=t==null?void 0:t.error;return e===400?new ms(e,a,n,s):e===401?new gs(e,a,n,s):e===403?new ps(e,a,n,s):e===404?new _s(e,a,n,s):e===409?new ws(e,a,n,s):e===422?new ys(e,a,n,s):e===429?new bs(e,a,n,s):e>=500?new vs(e,a,n,s):new X(e,a,n,s)}}class Y extends X{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class zt extends X{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class pn extends zt{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ms extends X{constructor(){super(...arguments),this.status=400}}class gs extends X{constructor(){super(...arguments),this.status=401}}class ps extends X{constructor(){super(...arguments),this.status=403}}class _s extends X{constructor(){super(...arguments),this.status=404}}class ws extends X{constructor(){super(...arguments),this.status=409}}class ys extends X{constructor(){super(...arguments),this.status=422}}class bs extends X{constructor(){super(...arguments),this.status=429}}class vs extends X{}class ue{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of ar(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null){let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(o&&o.error)throw new X(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new X(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new ue(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new we,o=Ss(e);for await(const c of o)for(const u of i.decode(c))yield u;for(const c of i.flush())yield c}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new ue(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new ue(()=>s(e),this.controller),new ue(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new cs({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await t.next();if(i)return s.close();const o=n.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*ar(r,e){if(!r.body)throw e.abort(),new M("Attempted to iterate over a response with no body");const t=new lr,n=new we,s=Ss(r.body);for await(const a of ir(s))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*ir(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=or(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function or(r){for(let n=0;n<r.length-2;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}class lr{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=cr(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}class we{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=we.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(we.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new M(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new M(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new M("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}we.NEWLINE_CHARS=new Set([`
`,"\r"]);we.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function cr(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function Ss(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const xs=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Cs=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&As(r),As=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",ur=r=>Cs(r)||xs(r)||fs(r);async function ks(r,e,t){var s;if(r=await r,t??(t=Cs(r)?{lastModified:r.lastModified,type:r.type}:{}),xs(r)){const a=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new nn([a],e,t)}const n=await hr(r);if(e||(e=fr(r)??"unknown_file"),!t.type){const a=(s=n[0])==null?void 0:s.type;typeof a=="string"&&(t={...t,type:a})}return new nn(n,e,t)}async function hr(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(As(r))e.push(await r.arrayBuffer());else if(mr(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${dr(r)}`);return e}function dr(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function fr(r){var e;return Yt(r.name)||Yt(r.filename)||((e=Yt(r.path))==null?void 0:e.split(/[\\/]/).pop())}const Yt=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},mr=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Wn=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",Ge=async r=>{const e=await gr(r.body);return us(e,r)},gr=async r=>{const e=new ls;return await Promise.all(Object.entries(r||{}).map(([t,n])=>sn(e,t,n))),e},sn=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(ur(t)){const n=await ks(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>sn(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>sn(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var ke={},pr=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},_r=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},et;async function Rs(r){const{response:e}=r;if(r.options.stream)return Re("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):ue.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const a=await e.json();return Re("response",e.status,e.url,e.headers,a),a}const s=await e.text();return Re("response",e.status,e.url,e.headers,s),s}class Gt extends Promise{constructor(e,t=Rs){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Gt(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class wr{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=Qt("maxRetries",t),this.timeout=Qt("timeout",n),this.httpAgent=s,this.fetch=a??os}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Cr(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Pr()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var f;const{method:t,path:n,query:s,headers:a={}}=e,i=Wn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(i),c=this.buildURL(n,s);"timeout"in e&&Qt("timeout",e.timeout);const u=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??hs(c),p=u+1e3;typeof((f=h==null?void 0:h.options)==null?void 0:f.timeout)=="number"&&p>(h.options.timeout??0)&&(h.options.timeout=p),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const _=this.buildHeaders({options:e,headers:a,contentLength:o});return{req:{method:t,...i&&{body:i},headers:_,...h&&{agent:h},signal:e.signal??null},url:c,timeout:u}}buildHeaders({options:e,headers:t,contentLength:n}){const s={};n&&(s["content-length"]=n);const a=this.defaultHeaders(e);return Hn(s,a),Hn(s,t),Wn(e.body)&&Je!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return X.generate(e,t,n,s)}request(e,t=null){return new Gt(this.makeRequest(e,t))}async makeRequest(e,t){var h,p;const n=await e;t==null&&(t=n.maxRetries??this.maxRetries),await this.prepareOptions(n);const{req:s,url:a,timeout:i}=this.buildRequest(n);if(await this.prepareRequest(s,{url:a,options:n}),Re("request",a,n,s.headers),(h=n.signal)!=null&&h.aborted)throw new Y;const o=new AbortController,c=await this.fetchWithTimeout(a,s,i,o).catch(rn);if(c instanceof Error){if((p=n.signal)!=null&&p.aborted)throw new Y;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new pn:new zt({cause:c})}const u=br(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const A=`retrying, ${t} attempts remaining`;return Re(`response (error; ${A})`,c.status,a,u),this.retryRequest(n,t,u)}const _=await c.text().catch(A=>rn(A).message),m=Ar(_),f=m?void 0:_;throw Re(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,f),this.makeStatusError(c.status,m,f,u)}return{response:c,options:n,controller:o}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new yr(this,n,e)}buildURL(e,t){const n=Rr(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Es(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new M(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=n==null?void 0:n["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Ye(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Se}`}}class Ps{constructor(e,t,n,s){et.set(this,void 0),pr(this,et,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new M("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,a]of n)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await _r(this,et,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(et=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class yr extends Gt{constructor(e,t,n){super(t,async s=>new n(e,s.response,await Rs(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const br=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),vr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},Q=r=>typeof r=="object"&&r!==null&&!Es(r)&&Object.keys(r).every(e=>Is(vr,e)),Sr=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Se,"X-Stainless-OS":qn(Deno.build.os),"X-Stainless-Arch":Un(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Se,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Se,"X-Stainless-OS":qn(process.platform),"X-Stainless-Arch":Un(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=xr();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Se,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Se,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function xr(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const Un=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",qn=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Vn;const Cr=()=>Vn??(Vn=Sr()),Ar=r=>{try{return JSON.parse(r)}catch{return}},kr=new RegExp("^(?:[a-z]+:)?//","i"),Rr=r=>kr.test(r),Ye=r=>new Promise(e=>setTimeout(e,r)),Qt=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new M(`${r} must be an integer`);if(e<0)throw new M(`${r} must be a positive integer`);return e},rn=r=>r instanceof Error?r:new Error(r),tt=r=>{var e,t,n,s;if(typeof process<"u")return((e=ke==null?void 0:ke[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function Es(r){if(!r)return!0;for(const e in r)return!1;return!0}function Is(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Hn(r,e){for(const t in e){if(!Is(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function Re(r,...e){typeof process<"u"&&(ke==null?void 0:ke.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${r}`,...e)}const Pr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),Er=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Xn(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class _n extends Ps{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class oe extends Ps{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class B{constructor(e){this._client=e}}let wt=class extends B{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};wt||(wt={});let yt=class extends B{constructor(){super(...arguments),this.completions=new wt(this._client)}};(function(r){r.Completions=wt})(yt||(yt={}));class bt extends B{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}bt||(bt={});class vt extends B{create(e,t){return this._client.post("/audio/transcriptions",Ge({body:e,...t}))}}vt||(vt={});class St extends B{create(e,t){return this._client.post("/audio/translations",Ge({body:e,...t}))}}St||(St={});class xt extends B{constructor(){super(...arguments),this.transcriptions=new vt(this._client),this.translations=new St(this._client),this.speech=new bt(this._client)}}(function(r){r.Transcriptions=vt,r.Translations=St,r.Speech=bt})(xt||(xt={}));class Ct extends B{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Q(e)?this.list({},e):this._client.getAPIList("/batches",wn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class wn extends oe{}(function(r){r.BatchesPage=wn})(Ct||(Ct={}));class At extends B{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Q(e)?this.list({},e):this._client.getAPIList("/assistants",yn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class yn extends oe{}(function(r){r.AssistantsPage=yn})(At||(At={}));function Jn(r){return typeof r.parse=="function"}const Pe=r=>(r==null?void 0:r.role)==="assistant",Ts=r=>(r==null?void 0:r.role)==="function",Fs=r=>(r==null?void 0:r.role)==="tool";var Z=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},F=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},J,rt,at,De,Ne,it,Be,he,je,ot,lt,xe,an,kt,on,ln,cn,un,Ms,hn;const zn=10;class Os{constructor(){J.add(this),this.controller=new AbortController,rt.set(this,void 0),at.set(this,()=>{}),De.set(this,()=>{}),Ne.set(this,void 0),it.set(this,()=>{}),Be.set(this,()=>{}),he.set(this,{}),this._chatCompletions=[],this.messages=[],je.set(this,!1),ot.set(this,!1),lt.set(this,!1),xe.set(this,!1),un.set(this,e=>{if(Z(this,ot,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Y),e instanceof Y)return Z(this,lt,!0,"f"),this._emit("abort",e);if(e instanceof M)return this._emit("error",e);if(e instanceof Error){const t=new M(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new M(String(e)))}),Z(this,rt,new Promise((e,t)=>{Z(this,at,e,"f"),Z(this,De,t,"f")}),"f"),Z(this,Ne,new Promise((e,t)=>{Z(this,it,e,"f"),Z(this,Be,t,"f")}),"f"),F(this,rt,"f").catch(()=>{}),F(this,Ne,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},F(this,un,"f"))},0)}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ts(e)||Fs(e))&&e.content)this._emit("functionCallResult",e.content);else if(Pe(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Pe(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}_connected(){this.ended||(F(this,at,"f").call(this),this._emit("connect"))}get ended(){return F(this,je,"f")}get errored(){return F(this,ot,"f")}get aborted(){return F(this,lt,"f")}abort(){this.controller.abort()}on(e,t){return(F(this,he,"f")[e]||(F(this,he,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=F(this,he,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(F(this,he,"f")[e]||(F(this,he,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Z(this,xe,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Z(this,xe,!0,"f"),await F(this,Ne,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new M("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),F(this,J,"m",an).call(this)}async finalMessage(){return await this.done(),F(this,J,"m",kt).call(this)}async finalFunctionCall(){return await this.done(),F(this,J,"m",on).call(this)}async finalFunctionCallResult(){return await this.done(),F(this,J,"m",ln).call(this)}async totalUsage(){return await this.done(),F(this,J,"m",cn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(F(this,je,"f"))return;e==="end"&&(Z(this,je,!0,"f"),F(this,it,"f").call(this));const n=F(this,he,"f")[e];if(n&&(F(this,he,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!F(this,xe,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,De,"f").call(this,s),F(this,Be,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!F(this,xe,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,De,"f").call(this,s),F(this,Be,"f").call(this,s),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=F(this,J,"m",kt).call(this);t&&this._emit("finalMessage",t);const n=F(this,J,"m",an).call(this);n&&this._emit("finalContent",n);const s=F(this,J,"m",on).call(this);s&&this._emit("finalFunctionCall",s);const a=F(this,J,"m",ln).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",F(this,J,"m",cn).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),F(this,J,"m",Ms).call(this,t);const a=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(a)}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var _;const s="function",{function_call:a="auto",stream:i,...o}=t,c=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=zn}=n||{},h={};for(const m of t.functions)h[m.name||m.function.name]=m;const p=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<u;++m){const g=(_=(await this._createChatCompletion(e,{...o,function_call:a,functions:p,messages:[...this.messages]},n)).choices[0])==null?void 0:_.message;if(!g)throw new M("missing message in ChatCompletion response");if(!g.function_call)return;const{name:S,arguments:A}=g.function_call,l=h[S];if(l){if(c&&c!==S){const P=`Invalid function_call: ${JSON.stringify(S)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,name:S,content:P});continue}}else{const P=`Invalid function_call: ${JSON.stringify(S)}. Available options are: ${p.map(T=>JSON.stringify(T.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:S,content:P});continue}let d;try{d=Jn(l)?await l.parse(A):A}catch(P){this._addMessage({role:s,name:S,content:P instanceof Error?P.message:String(P)});continue}const y=await l.function(d,this),b=F(this,J,"m",hn).call(this,y);if(this._addMessage({role:s,name:S,content:b}),c)return}}async _runTools(e,t,n){var _,m;const s="tool",{tool_choice:a="auto",stream:i,...o}=t,c=typeof a!="string"&&((_=a==null?void 0:a.function)==null?void 0:_.name),{maxChatCompletions:u=zn}=n||{},h={};for(const f of t.tools)f.type==="function"&&(h[f.function.name||f.function.function.name]=f.function);const p="tools"in t?t.tools.map(f=>f.type==="function"?{type:"function",function:{name:f.function.name||f.function.function.name,parameters:f.function.parameters,description:f.function.description}}:f):void 0;for(const f of t.messages)this._addMessage(f,!1);for(let f=0;f<u;++f){const S=(m=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:p,messages:[...this.messages]},n)).choices[0])==null?void 0:m.message;if(!S)throw new M("missing message in ChatCompletion response");if(!S.tool_calls)return;for(const A of S.tool_calls){if(A.type!=="function")continue;const l=A.id,{name:d,arguments:y}=A.function,b=h[d];if(b){if(c&&c!==d){const I=`Invalid tool_call: ${JSON.stringify(d)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:l,content:I});continue}}else{const I=`Invalid tool_call: ${JSON.stringify(d)}. Available options are: ${p.map(G=>JSON.stringify(G.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:l,content:I});continue}let P;try{P=Jn(b)?await b.parse(y):y}catch(I){const G=I instanceof Error?I.message:String(I);this._addMessage({role:s,tool_call_id:l,content:G});continue}const T=await b.function(P,this),O=F(this,J,"m",hn).call(this,T);if(this._addMessage({role:s,tool_call_id:l,content:O}),c)return}}}}rt=new WeakMap,at=new WeakMap,De=new WeakMap,Ne=new WeakMap,it=new WeakMap,Be=new WeakMap,he=new WeakMap,je=new WeakMap,ot=new WeakMap,lt=new WeakMap,xe=new WeakMap,un=new WeakMap,J=new WeakSet,an=function(){return F(this,J,"m",kt).call(this).content??null},kt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Pe(t))return{...t,content:t.content??null}}throw new M("stream ended without producing a ChatCompletionMessage with role=assistant")},on=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(Pe(s)&&(s!=null&&s.function_call))return s.function_call;if(Pe(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},ln=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ts(t)&&t.content!=null||Fs(t)&&t.content!=null&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},cn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ms=function(e){if(e.n!=null&&e.n>1)throw new M("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},hn=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class $e extends Os{static runFunctions(e,t,n){const s=new $e,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new $e,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e){super._addMessage(e),Pe(e)&&e.content&&this._emit("content",e.content)}}var ee=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Zt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},le,me,en,tn,nt,Gn;class Ke extends Os{constructor(){super(...arguments),le.add(this),me.set(this,void 0)}get currentChatCompletionSnapshot(){return ee(this,me,"f")}static fromReadableStream(e){const t=new Ke;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new Ke;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var i;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),ee(this,le,"m",en).call(this);const a=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)ee(this,le,"m",tn).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Y;return this._addChatCompletion(ee(this,le,"m",nt).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ee(this,le,"m",en).call(this),this._connected();const s=ue.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(ee(this,le,"m",nt).call(this)),ee(this,le,"m",tn).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new Y;return this._addChatCompletion(ee(this,le,"m",nt).call(this))}[(me=new WeakMap,le=new WeakSet,en=function(){this.ended||Zt(this,me,void 0,"f")},tn=function(t){var i,o,c;if(this.ended)return;const n=ee(this,le,"m",Gn).call(this,t);this._emit("chunk",t,n);const s=(o=(i=t.choices[0])==null?void 0:i.delta)==null?void 0:o.content,a=(c=n.choices[0])==null?void 0:c.message;s!=null&&(a==null?void 0:a.role)==="assistant"&&(a!=null&&a.content)&&this._emit("content",s,a.content)},nt=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");const t=ee(this,me,"f");if(!t)throw new M("request ended without sending any chunks");return Zt(this,me,void 0,"f"),Ir(t)},Gn=function(t){var n,s,a;let i=ee(this,me,"f");const{choices:o,...c}=t;i?Object.assign(i,c):i=Zt(this,me,{...c,choices:[]},"f");for(const{delta:u,finish_reason:h,index:p,logprobs:_=null,...m}of t.choices){let f=i.choices[p];if(f||(f=i.choices[p]={finish_reason:h,index:p,message:{},logprobs:_,...m}),_)if(!f.logprobs)f.logprobs=Object.assign({},_);else{const{content:y,...b}=_;Object.assign(f.logprobs,b),y&&((n=f.logprobs).content??(n.content=[]),f.logprobs.content.push(...y))}if(h&&(f.finish_reason=h),Object.assign(f,m),!u)continue;const{content:g,function_call:S,role:A,tool_calls:l,...d}=u;if(Object.assign(f.message,d),g&&(f.message.content=(f.message.content||"")+g),A&&(f.message.role=A),S&&(f.message.function_call?(S.name&&(f.message.function_call.name=S.name),S.arguments&&((s=f.message.function_call).arguments??(s.arguments=""),f.message.function_call.arguments+=S.arguments)):f.message.function_call=S),l){f.message.tool_calls||(f.message.tool_calls=[]);for(const{index:y,id:b,type:P,function:T,...O}of l){const I=(a=f.message.tool_calls)[y]??(a[y]={});Object.assign(I,O),b&&(I.id=b),P&&(I.type=P),T&&(I.function??(I.function={arguments:""})),T!=null&&T.name&&(I.function.name=T.name),T!=null&&T.arguments&&(I.function.arguments+=T.arguments)}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ue(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Ir(r){const{id:e,choices:t,created:n,model:s,system_fingerprint:a,...i}=r;return{...i,id:e,choices:t.map(({message:o,finish_reason:c,index:u,logprobs:h,...p})=>{if(!c)throw new M(`missing finish_reason for choice ${u}`);const{content:_=null,function_call:m,tool_calls:f,...g}=o,S=o.role;if(!S)throw new M(`missing role for choice ${u}`);if(m){const{arguments:A,name:l}=m;if(A==null)throw new M(`missing function_call.arguments for choice ${u}`);if(!l)throw new M(`missing function_call.name for choice ${u}`);return{...p,message:{content:_,function_call:{arguments:A,name:l},role:S},finish_reason:c,index:u,logprobs:h}}return f?{...p,index:u,finish_reason:c,logprobs:h,message:{...g,role:S,content:_,tool_calls:f.map((A,l)=>{const{function:d,type:y,id:b,...P}=A,{arguments:T,name:O,...I}=d||{};if(b==null)throw new M(`missing choices[${u}].tool_calls[${l}].id
${st(r)}`);if(y==null)throw new M(`missing choices[${u}].tool_calls[${l}].type
${st(r)}`);if(O==null)throw new M(`missing choices[${u}].tool_calls[${l}].function.name
${st(r)}`);if(T==null)throw new M(`missing choices[${u}].tool_calls[${l}].function.arguments
${st(r)}`);return{...P,id:b,type:y,function:{...I,name:O,arguments:T}}})}}:{...p,message:{...g,content:_,role:S},finish_reason:c,index:u,logprobs:h}}),created:n,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}}}function st(r){return JSON.stringify(r)}class Ee extends Ke{static fromReadableStream(e){const t=new Ee;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new Ee,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new Ee,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}}let Ds=class extends B{runFunctions(e,t){return e.stream?Ee.runFunctions(this._client.chat.completions,e,t):$e.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?Ee.runTools(this._client.chat.completions,e,t):$e.runTools(this._client.chat.completions,e,t)}stream(e,t){return Ke.createChatCompletion(this._client.chat.completions,e,t)}};class Rt extends B{constructor(){super(...arguments),this.completions=new Ds(this._client)}}(function(r){r.Completions=Ds})(Rt||(Rt={}));var te=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},j=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ct,ut,Le,We,ht,Ue,de,qe,dt,ft,Ce,dn;class Tr{constructor(){this.controller=new AbortController,ct.set(this,void 0),ut.set(this,()=>{}),Le.set(this,()=>{}),We.set(this,void 0),ht.set(this,()=>{}),Ue.set(this,()=>{}),de.set(this,{}),qe.set(this,!1),dt.set(this,!1),ft.set(this,!1),Ce.set(this,!1),dn.set(this,e=>{if(te(this,dt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Y),e instanceof Y)return te(this,ft,!0,"f"),this._emit("abort",e);if(e instanceof M)return this._emit("error",e);if(e instanceof Error){const t=new M(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new M(String(e)))}),te(this,ct,new Promise((e,t)=>{te(this,ut,e,"f"),te(this,Le,t,"f")}),"f"),te(this,We,new Promise((e,t)=>{te(this,ht,e,"f"),te(this,Ue,t,"f")}),"f"),j(this,ct,"f").catch(()=>{}),j(this,We,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},j(this,dn,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(j(this,ut,"f").call(this),this._emit("connect"))}get ended(){return j(this,qe,"f")}get errored(){return j(this,dt,"f")}get aborted(){return j(this,ft,"f")}abort(){this.controller.abort()}on(e,t){return(j(this,de,"f")[e]||(j(this,de,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=j(this,de,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(j(this,de,"f")[e]||(j(this,de,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{te(this,Ce,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){te(this,Ce,!0,"f"),await j(this,We,"f")}_emit(e,...t){if(j(this,qe,"f"))return;e==="end"&&(te(this,qe,!0,"f"),j(this,ht,"f").call(this));const n=j(this,de,"f")[e];if(n&&(j(this,de,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!j(this,Ce,"f")&&!(n!=null&&n.length)&&Promise.reject(s),j(this,Le,"f").call(this,s),j(this,Ue,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!j(this,Ce,"f")&&!(n!=null&&n.length)&&Promise.reject(s),j(this,Le,"f").call(this,s),j(this,Ue,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,a){return await this._createToolAssistantStream(n,e,t,s,a)}async _createThreadAssistantStream(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a=await e.createAndRun({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(a)}async _createToolAssistantStream(e,t,n,s,a){const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(t,n,{...s,stream:!1},{...a,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,n,s){const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i=await e.create(t,{...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(i)}}ct=new WeakMap,ut=new WeakMap,Le=new WeakMap,We=new WeakMap,ht=new WeakMap,Ue=new WeakMap,de=new WeakMap,qe=new WeakMap,dt=new WeakMap,ft=new WeakMap,Ce=new WeakMap,dn=new WeakMap;var R=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},$=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},V,fn,ce,mt,ne,pe,Ae,ge,Pt,K,gt,pt,ze,Ve,He,$n,Kn,Yn,Qn,Zn,es,ts;class se extends Tr{constructor(){super(...arguments),V.add(this),fn.set(this,[]),ce.set(this,{}),mt.set(this,{}),ne.set(this,void 0),pe.set(this,void 0),Ae.set(this,void 0),ge.set(this,void 0),Pt.set(this,void 0),K.set(this,void 0),gt.set(this,void 0),pt.set(this,void 0),ze.set(this,void 0)}[(fn=new WeakMap,ce=new WeakMap,mt=new WeakMap,ne=new WeakMap,pe=new WeakMap,Ae=new WeakMap,ge=new WeakMap,Pt=new WeakMap,K=new WeakMap,gt=new WeakMap,pt=new WeakMap,ze=new WeakMap,V=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new se;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=ue.fromReadableStream(e,this.controller);for await(const i of s)R(this,V,"m",Ve).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Y;return this._addRun(R(this,V,"m",He).call(this))}toReadableStream(){return new ue(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,a){const i=new se;return i._run(()=>i._runToolAssistantStream(e,t,n,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,s,a){var u;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},c=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const h of c)R(this,V,"m",Ve).call(this,h);if((u=c.controller.signal)!=null&&u.aborted)throw new Y;return this._addRun(R(this,V,"m",He).call(this))}static createThreadAssistantStream(e,t,n){const s=new se;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const a=new se;return a._run(()=>a._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return R(this,gt,"f")}currentRun(){return R(this,pt,"f")}currentMessageSnapshot(){return R(this,ne,"f")}currentRunStepSnapshot(){return R(this,ze,"f")}async finalRunSteps(){return await this.done(),Object.values(R(this,ce,"f"))}async finalMessages(){return await this.done(),Object.values(R(this,mt,"f"))}async finalRun(){if(await this.done(),!R(this,pe,"f"))throw Error("Final run was not received.");return R(this,pe,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const c of i)R(this,V,"m",Ve).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new Y;return this._addRun(R(this,V,"m",He).call(this))}async _createAssistantStream(e,t,n,s){var c;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)R(this,V,"m",Ve).call(this,u);if((c=o.controller.signal)!=null&&c.aborted)throw new Y;return this._addRun(R(this,V,"m",He).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(Xn(a)&&Xn(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}}Ve=function(e){if(!this.ended)switch($(this,gt,e,"f"),R(this,V,"m",Yn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":R(this,V,"m",ts).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R(this,V,"m",Kn).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":R(this,V,"m",$n).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},He=function(){if(this.ended)throw new M("stream has ended, this shouldn't happen");if(!R(this,pe,"f"))throw Error("Final run has not been received");return R(this,pe,"f")},$n=function(e){const[t,n]=R(this,V,"m",Zn).call(this,e,R(this,ne,"f"));$(this,ne,t,"f"),R(this,mt,"f")[t.id]=t;for(const s of n){const a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=R(this,Ae,"f")){if(R(this,ge,"f"))switch(R(this,ge,"f").type){case"text":this._emit("textDone",R(this,ge,"f").text,R(this,ne,"f"));break;case"image_file":this._emit("imageFileDone",R(this,ge,"f").image_file,R(this,ne,"f"));break}$(this,Ae,s.index,"f")}$(this,ge,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(R(this,Ae,"f")!==void 0){const s=e.data.content[R(this,Ae,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,R(this,ne,"f"));break;case"text":this._emit("textDone",s.text,R(this,ne,"f"));break}}R(this,ne,"f")&&this._emit("messageDone",e.data),$(this,ne,void 0,"f")}},Kn=function(e){const t=R(this,V,"m",Qn).call(this,e);switch($(this,ze,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==R(this,Pt,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(R(this,K,"f")&&this._emit("toolCallDone",R(this,K,"f")),$(this,Pt,a.index,"f"),$(this,K,t.step_details.tool_calls[a.index],"f"),R(this,K,"f")&&this._emit("toolCallCreated",R(this,K,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":$(this,ze,void 0,"f"),e.data.step_details.type=="tool_calls"&&R(this,K,"f")&&(this._emit("toolCallDone",R(this,K,"f")),$(this,K,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Yn=function(e){R(this,fn,"f").push(e),this._emit("event",e)},Qn=function(e){switch(e.event){case"thread.run.step.created":return R(this,ce,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=R(this,ce,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=se.accumulateDelta(t,n.delta);R(this,ce,"f")[e.data.id]=s}return R(this,ce,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":R(this,ce,"f")[e.data.id]=e.data;break}if(R(this,ce,"f")[e.data.id])return R(this,ce,"f")[e.data.id];throw new Error("No snapshot available")},Zn=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=R(this,V,"m",es).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},es=function(e,t){return se.accumulateDelta(t,e)},ts=function(e){switch($(this,pt,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":$(this,pe,e.data,"f"),R(this,K,"f")&&(this._emit("toolCallDone",R(this,K,"f")),$(this,K,void 0,"f"));break}};class Et extends B{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Q(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,bn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class bn extends oe{}(function(r){r.MessagesPage=bn})(Et||(Et={}));class It extends B{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t,n={},s){return Q(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,vn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class vn extends oe{}(function(r){r.RunStepsPage=vn})(It||(It={}));class Tt extends B{constructor(){super(...arguments),this.steps=new It(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return Q(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Sn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return se.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Ye(o);break;case"requires_action":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return se.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const a=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,n,s){return se.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class Sn extends oe{}(function(r){r.RunsPage=Sn,r.Steps=It,r.RunStepsPage=vn})(Tt||(Tt={}));class Ft extends B{constructor(){super(...arguments),this.runs=new Tt(this._client),this.messages=new Et(this._client)}create(e={},t){return Q(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return se.createThreadAssistantStream(e,this._client.beta.threads,t)}}(function(r){r.Runs=Tt,r.RunsPage=Sn,r.Messages=Et,r.MessagesPage=bn})(Ft||(Ft={}));const Fr=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};let Mt=class extends B{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},n){return Q(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,$t,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=a.response.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Ye(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}};class $t extends oe{}(function(r){r.VectorStoreFilesPage=$t})(Mt||(Mt={}));class Ot extends B{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return Q(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,$t,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Ye(o);break;case"failed":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t===null||t.length==0)throw new Error("No files provided to process.");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,c=t.values(),u=[...n];async function h(_){for(let m of _){const f=await o.files.create({file:m,purpose:"assistants"},s);u.push(f.id)}}const p=Array(i).fill(c).map(h);return await Fr(p),await this.createAndPoll(e,{file_ids:u})}}Ot||(Ot={});class Dt extends B{constructor(){super(...arguments),this.files=new Mt(this._client),this.fileBatches=new Ot(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return Q(e)?this.list({},e):this._client.getAPIList("/vector_stores",xn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class xn extends oe{}(function(r){r.VectorStoresPage=xn,r.Files=Mt,r.VectorStoreFilesPage=$t,r.FileBatches=Ot})(Dt||(Dt={}));class Nt extends B{constructor(){super(...arguments),this.vectorStores=new Dt(this._client),this.chat=new Rt(this._client),this.assistants=new At(this._client),this.threads=new Ft(this._client)}}(function(r){r.VectorStores=Dt,r.VectorStoresPage=xn,r.Chat=Rt,r.Assistants=At,r.AssistantsPage=yn,r.Threads=Ft})(Nt||(Nt={}));class Bt extends B{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Bt||(Bt={});class jt extends B{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}jt||(jt={});class Lt extends B{create(e,t){return this._client.post("/files",Ge({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Q(e)?this.list({},e):this._client.getAPIList("/files",Cn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Ye(t),i=await this.retrieve(e),Date.now()-a>n)throw new pn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}}class Cn extends _n{}(function(r){r.FileObjectsPage=Cn})(Lt||(Lt={}));class Wt extends B{list(e,t={},n){return Q(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,An,{query:t,...n})}}class An extends oe{}(function(r){r.FineTuningJobCheckpointsPage=An})(Wt||(Wt={}));class Ut extends B{constructor(){super(...arguments),this.checkpoints=new Wt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Q(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",kn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Q(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Rn,{query:t,...n})}}class kn extends oe{}class Rn extends oe{}(function(r){r.FineTuningJobsPage=kn,r.FineTuningJobEventsPage=Rn,r.Checkpoints=Wt,r.FineTuningJobCheckpointsPage=An})(Ut||(Ut={}));class qt extends B{constructor(){super(...arguments),this.jobs=new Ut(this._client)}}(function(r){r.Jobs=Ut,r.FineTuningJobsPage=kn,r.FineTuningJobEventsPage=Rn})(qt||(qt={}));class Vt extends B{createVariation(e,t){return this._client.post("/images/variations",Ge({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ge({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Vt||(Vt={});class Ht extends B{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Pn,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Pn extends _n{}(function(r){r.ModelsPage=Pn})(Ht||(Ht={}));class Xt extends B{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Xt||(Xt={});var Ns;class W extends wr{constructor({baseURL:e=tt("OPENAI_BASE_URL"),apiKey:t=tt("OPENAI_API_KEY"),organization:n=tt("OPENAI_ORG_ID")??null,project:s=tt("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new M("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&Er())throw new M(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Bt(this),this.chat=new yt(this),this.embeddings=new jt(this),this.files=new Lt(this),this.images=new Vt(this),this.audio=new xt(this),this.moderations=new Xt(this),this.models=new Ht(this),this.fineTuning=new qt(this),this.beta=new Nt(this),this.batches=new Ct(this),this._options=i,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}Ns=W;W.OpenAI=Ns;W.OpenAIError=M;W.APIError=X;W.APIConnectionError=zt;W.APIConnectionTimeoutError=pn;W.APIUserAbortError=Y;W.NotFoundError=_s;W.ConflictError=ws;W.RateLimitError=bs;W.BadRequestError=ms;W.AuthenticationError=gs;W.InternalServerError=vs;W.PermissionDeniedError=ps;W.UnprocessableEntityError=ys;W.toFile=ks;W.fileFromPath=ds;(function(r){r.Page=_n,r.CursorPage=oe,r.Completions=Bt,r.Chat=yt,r.Embeddings=jt,r.Files=Lt,r.FileObjectsPage=Cn,r.Images=Vt,r.Audio=xt,r.Moderations=Xt,r.Models=Ht,r.ModelsPage=Pn,r.FineTuning=qt,r.Beta=Nt,r.Batches=Ct,r.BatchesPage=wn})(W||(W={}));var Bs={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.parse=void 0;function e(l){if(l!==void 0){if(l===null)return null;if(l==="")return"";try{return JSON.parse(l)}catch(d){const[y,b]=l.trimLeft()[0]===":"?t(l,d):t(l,d,_);return e.lastParseReminding=b,e.onExtraToken&&b.length>0&&e.onExtraToken(l,y,b),y}}}r.parse=e,function(l){l.onExtraToken=(d,y,b)=>{console.error("parsed json with extra tokens:",{text:d,data:y,reminding:b})}}(e=r.parse||(r.parse={}));function t(l,d,y){const b=s[l[0]]||y;if(!b)throw console.error(`no parser registered for ${JSON.stringify(l[0])}:`,{s:l}),d;return b(l,d)}function n(l,d,y){return l[0]==='"'?h(l):l[0]==="'"?p(l):_(l,d,y)}const s={};function a(l){return l.trimLeft()}s[" "]=i,s["\r"]=i,s[`
`]=i,s["	"]=i;function i(l,d){return l=a(l),t(l,d)}s["["]=o;function o(l,d){l=l.substr(1);const y=[];for(l=a(l);l.length>0;){if(l[0]==="]"){l=l.substr(1);break}const b=t(l,d,(P,T)=>_(P,T,[",","]"]));y.push(b[0]),l=b[1],l=a(l),l[0]===","&&(l=l.substring(1),l=a(l))}return[y,l]}for(const l of"0123456789.-".slice())s[l]=c;function c(l){for(let d=0;d<l.length;d++){const y=l[d];if(s[y]===c)continue;const b=l.substring(0,d);return l=l.substring(d),[u(b),l]}return[u(l),""]}function u(l){if(l==="-")return-0;const d=+l;return Number.isNaN(d)?l:d}s['"']=h;function h(l){for(let d=1;d<l.length;d++){const y=l[d];if(y==="\\"){d++;continue}if(y==='"'){const b=l.substring(0,d+1).replace(/\n/g,"\\n");return l=l.substring(d+1),[JSON.parse(b),l]}}return[JSON.parse(l+'"'),""]}s["'"]=p;function p(l){for(let d=1;d<l.length;d++){const y=l[d];if(y==="\\"){d++;continue}if(y==="'"){const b=l.substring(0,d+1).replace(/\n/g,"\\n");return l=l.substring(d+1),[JSON.parse('"'+b.slice(1,-1)+'"'),l]}}return[JSON.parse('"'+l.slice(1)+'"'),""]}function _(l,d,y=[" "]){const b=Math.min(...y.map(O=>{const I=l.indexOf(O);return I===-1?l.length:I})),P=l.substring(0,b).trim(),T=l.substring(b);return[P,T]}s["{"]=m;function m(l,d){l=l.substr(1);const y={};for(l=a(l);l.length>0;){if(l[0]==="}"){l=l.substr(1);break}const b=n(l,d,[":","}"]),P=b[0];if(l=b[1],l=a(l),l[0]!==":"){y[P]=void 0;break}if(l=l.substr(1),l=a(l),l.length===0){y[P]=void 0;break}const T=t(l,d);y[P]=T[0],l=T[1],l=a(l),l[0]===","&&(l=l.substr(1),l=a(l))}return[y,l]}s.t=f;function f(l,d){return A(l,"true",!0,d)}s.f=g;function g(l,d){return A(l,"false",!1,d)}s.n=S;function S(l,d){return A(l,"null",null,d)}function A(l,d,y,b){for(let P=d.length;P>=1;P--)if(l.startsWith(d.slice(0,P)))return[y,l.slice(P)];{const P=JSON.stringify(l.slice(0,d.length));throw console.error(`unknown token starting with ${P}:`,{s:l}),b}}})(Bs);const Mr=[{name:"Brokerage–The Fidelity Account®",description:"This multi-feature trading and investing account allows you to select from a broad range of investment choices, including stocks, bonds, ETFs, options, and mutual funds."},{name:"Roth IRA",description:"Save for retirement with after-tax dollars and withdraw the money tax-free in retirement."},{name:"Rollover IRA",description:"Consolidate your old 401(k) and workplace accounts into a centralized account without taxes or penalties."},{name:"Traditional IRA",description:"Save for retirement and reduce your taxable income, if eligible, and your potential earnings could grow tax-deferred."},{name:"Fidelity Cash Management Account",description:"This account offers you ways to spend, save, and invest, plus features of a traditional checking account."},{name:"Fidelity Go®",description:"Our robo advisor makes investing quick, simple, and affordable. We’ll handle the investing so you don't have to."},{name:"Inherited IRA",description:"An account specifically designed for retirement plan beneficiaries—those who have inherited an IRA or workplace savings plan, such as a 401(k)."},{name:"Fidelity HSA®",description:"Investing your health savings account (HSA) for potential tax-free growth can help you save for qualified medical expenses."},{name:"Custodial Account",description:"This account is a way to save or give a financial gift to a child. Funds can be invested in a range of options—all to give a child a better future."},{name:"SEP IRA",description:"This account helps self-employed individuals and small-business owners get access to a tax-deferred benefit when saving for retirement."},{name:"Fidelity Youth Account",description:"Teens 13 to 17 own and manage (with parental oversight) this account, where they can learn to save, spend, and invest in one secure place."},{name:"529 Account",description:"This account is flexible, tax-advantaged, and designed specifically for education savings. Funds can be used for qualified educational expenses at schools nationwide."},{name:"Trust Account",description:"A trust can help you protect your legacy and provide you with greater control over how your wealth is distributed."},{name:"Roth IRA–Fidelity Go®",description:"An account that lets you grow your retirement savings with after-tax dollars and withdraw the money tax-free when you need it."},{name:"Roth IRA–Managed FidFolios℠",description:"An account that lets you grow your retirement savings with after-tax dollars and withdraw the money tax-free when you need it."},{name:"Inherited Roth IRA",description:"An account specifically designed for retirement plan beneficiaries—those who inherit a Roth IRA or workplace savings plan, such as a Roth 401(k)."},{name:"Rollover IRA–Fidelity Go®",description:"We choose and manage your investments using your goals and risk tolerance in this digitally managed account."},{name:"Rollover IRA–Managed FidFolios℠",description:"Our team chooses the stocks for your portfolio and then makes all the trades, keeping you informed along the way."},{name:"Traditional IRA–Managed FidFolios℠",description:"Save for retirement and have your potential earnings grow tax-deferred in this account. You also may be able to deduct your contributions."},{name:"Traditional IRA–Fidelity Go®",description:"Save for retirement and let your potential earnings grow tax-deferred in this account. You also may be able to deduct your contributions."},{name:"Self-employed 401(k)",description:"An account that caters to the needs of self-employed and owner-only businesses."},{name:"SIMPLE IRA",description:"An account to help self-employed individuals and small-business owners with 100 or fewer employees offer tax-advantaged retirement plans."},{name:"Investment-Only Plans for Small Business",description:"This brokerage account is designed for small businesses that have qualified plans and would like to include offerings from Fidelity."},{name:"401(k) Plan for Small Businesses℠",description:"This account has simple plan choices and fewer administrative burdens, helping to limit the time needed to focus on managing a 401(k)."},{name:"Fidelity Crypto®–Offered by Fidelity Digital Assets℠",description:"Open a Fidelity Crypto® account to trade bitcoin and ethereum, and get education that makes sense of this new space."},{name:"The Fidelity Account® for Businesses",description:"This low-cost account helps you manage your business finances with comprehensive trading, mutual fund, and cash management features."},{name:"Fidelity Managed FidFolios℠",description:"Choose from 6 investment strategies, customize it, and let our pros go to work for you. We'll look for tax savings to help you keep more of what you earn."},{name:"Portfolio Advisory Services Accounts",description:"Professionally managed, multi-asset class portfolios that can be configured around your comfort with risk, goals, and investment preferences."},{name:"Fidelity Separately Managed Accounts",description:"Personalized, single-asset-class portfolios of individual securities that seek to meet specific objectives, such as dividend income or tax-free interest income."},{name:"Roth IRA for Kids",description:"This is a way to help your child start saving for retirement. It’s opened on behalf of a child who has earned income and it’s managed by an adult."},{name:"The Attainable Savings Plan®",description:"This account can help individuals with disabilities and their families save for their disability expenses while keeping benefits such as Supplemental Security Income and Medicaid."},{name:"Fidelity Go® HSA",description:"We choose investments for your health savings account (HSA) and help generate tax-free growth as you save for qualified medical expenses."},{name:"Fidelity Charitable® Giving Account®",description:"This account can help you maximize your impact in a tax-smart way when donating to your favorite charities."},{name:"Estate Account",description:"With this account, you manage investments on behalf of an estate to help protect assets and make distributions."},{name:"Fidelity Personal Retirement Annuity®",description:"This annuity is an option that allows you to increase your tax-deferred retirement savings beyond the contribution limits of an IRA or 401(k)."},{name:"Deferred Income Annuities",description:"Deferred income annuities provide you, or you and your spouse, a guaranteed income for a set period of time or for the rest of your life."},{name:"Deferred Fixed Annuities",description:"Offer a guaranteed rate of return, with tax deferral, over a set time period."},{name:"Immediate Fixed Income Annuities",description:"Immediate fixed income annuities provide a guaranteed stream of income for the rest of your life or a set period of time."},{name:"Universal Life",description:"Universal life insurance provides lifetime coverage and the ability to leave your loved ones with a lasting legacy."},{name:"Term Life Insurance",description:"Term life insurance can provide loved ones financial protection to help maintain their lifestyle if you were no longer there."},{name:"Fidelity Basket Portfolios",description:"You’re in control. Pick the stocks and ETFs on your own or get started investing with prebuilt models from the experts."}],js=new W({apiKey:Xe(Xs),dangerouslyAllowBrowser:!0}),Or=async()=>{const r=[{role:"system",content:`
  A user has provided the following information and conversed with a financial chat bot: ${JSON.stringify(Xe(ie))};
  Based on the data provided, your job is to provide up to 3 recommendations of account types detailed below:${JSON.stringify(Mr)}
  `},{role:"user",content:`Please provide your recommendations in a JSON object in the following format:
      recommendations = {
        name: Name of Account
        rationale: based on the conversation, why do you recommend this account type.  Length < 1-2 sentences
      }[]
      maximum array size is 3.  If there are fewer than 3 applicable accounts, only return those.
      Return at least 1 recommendation, always;
      In your recommendation, please reference something the user mentioned specifically as a rationale for why this account makes sense.
			Please note that certain accounts might have income restrictions, be cognizant of this when making recommendations.
      `}],e=await js.chat.completions.create({model:"gpt-4-turbo",response_format:{type:"json_object"},messages:r,stream:!1});return JSON.parse(e.choices[0].message.content||"")},aa=async r=>{var i,o;const e=`
  Your job is to help the user figure out which accounts they should open at a large financial institution.
  There are 43 different accounts to choose from and we will help the user.
  Based on their provided information:
  ${JSON.stringify(Xe(ie))}
  Your job is to ask them follow up questions that help determine which accounts they should open based upon their goals.
	Please reference the goals they selected in the conversation.
  Keep your questions friendly and professional.
  Keep your questions open ended and as brief as possible.
  Only ask one question at a time.
  Limit questions to 1-2 sentences MAX.
  Do not ask them about specific accounts, ask about their goals, it is your job to recommend accounts.
  If the user asks a question about any topic not related to their personal finance or account opening, please kindly re-direct the conversation
  Please continue asking questions until they've provided sufficient data to recommend an account THAT MEETS THE SPECIFIC GOALS THEY'VE INPUT,
	At a minimum please collect: age, marital status, net worth and income.
	Collect any additional information needed to make sure we can provide a recommendation for the specific goal they've selected.
	Once the user has provided sufficient data, tell then "Your recommendations are ready, but you may keep chatting if you'd like"
  Please generate JSON output in the format: {
    message: your message to the user;
    complete: (boolean) whether or not the user has provided sufficient data to recommend an account to open
  }
  `,t=r!==""?[{role:"system",content:e},...Xe(Ze),{role:"user",content:r}]:[{role:"system",content:e},...Xe(Ze)],n=await js.chat.completions.create({model:"gpt-4-turbo",response_format:{type:"json_object"},messages:t,stream:!0});let s="",a={message:"",complete:!1};Ze.update(c=>[...c,{role:"assistant",content:"..."}]);for await(const c of n)if(s+=((o=(i=c.choices[0])==null?void 0:i.delta)==null?void 0:o.content)||"",s.length>0)try{a=Bs.parse(s),Ze.update(u=>[...u.slice(0,-1),{role:"assistant",content:a.message||"..."}])}catch(u){console.log("issue parsing - carry on!",u)}(a==null?void 0:a.complete)===!0&&Js.set(!0)};function Dr(r){let e,t,n,s="What's your email?",a,i,o="We'll use this to save your results, so you can see them later",c,u,h,p,_,m="Back",f,g,S,A,l;return{c(){e=x("div"),t=x("div"),n=x("h1"),n.textContent=s,a=D(),i=x("p"),i.textContent=o,c=D(),u=x("textarea"),h=D(),p=x("div"),_=x("button"),_.textContent=m,f=D(),g=x("button"),S=re("Next"),this.h()},l(d){e=C(d,"DIV",{class:!0});var y=E(e);t=C(y,"DIV",{class:!0});var b=E(t);n=C(b,"H1",{class:!0,"data-svelte-h":!0}),U(n)!=="svelte-17nzind"&&(n.textContent=s),a=N(b),i=C(b,"P",{class:!0,"data-svelte-h":!0}),U(i)!=="svelte-trs68f"&&(i.textContent=o),c=N(b),u=C(b,"TEXTAREA",{rows:!0,class:!0}),E(u).forEach(k),h=N(b),p=C(b,"DIV",{class:!0});var P=E(p);_=C(P,"BUTTON",{class:!0,"data-svelte-h":!0}),U(_)!=="svelte-1admezx"&&(_.textContent=m),f=N(P),g=C(P,"BUTTON",{class:!0});var T=E(g);S=ae(T,"Next"),T.forEach(k),P.forEach(k),b.forEach(k),y.forEach(k),this.h()},h(){v(n,"class","font-light"),v(i,"class","text-fidelity-neutral-500 my-3"),v(u,"rows","1"),v(u,"class","svelte-zdeguy"),v(_,"class","back"),v(g,"class","next"),g.disabled=r[5],v(p,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),v(t,"class","w-96 h-1/2 mx-auto text-center"),v(e,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(d,y){z(d,e,y),w(e,t),w(t,n),w(t,a),w(t,i),w(t,c),w(t,u),r[7](u),Ie(u,r[3].email),w(t,h),w(t,p),w(p,_),w(p,f),w(p,g),w(g,S),A||(l=[H(u,"input",r[8]),H(u,"keydown",r[9]),H(_,"click",r[10]),H(g,"click",r[11])],A=!0)},p(d,[y]){y&8&&Ie(u,d[3].email),y&32&&(g.disabled=d[5])},i:q,o:q,d(d){d&&k(e),r[7](null),A=!1,Jt(l)}}}function Nr(r,e,t){let n,s;Me(r,ie,g=>t(3,s=g));let{back:a}=e,{next:i}=e,{changeStep:o=g=>{}}=e,c;Fe(()=>{_e.set(!0),c==null||c.focus(),window.scrollTo(0,0)});const u=g=>{g.key==="Enter"&&(g.preventDefault(),o(i))};function h(g){mn[g?"unshift":"push"](()=>{c=g,t(4,c)})}function p(){s.email=this.value,ie.set(s)}const _=g=>u(g),m=()=>o(a),f=()=>o(i);return r.$$set=g=>{"back"in g&&t(0,a=g.back),"next"in g&&t(1,i=g.next),"changeStep"in g&&t(2,o=g.changeStep)},r.$$.update=()=>{r.$$.dirty&8&&t(5,n=s.email?s.email.length<=4:!0)},[a,i,o,s,c,n,u,h,p,_,m,f]}class ia extends be{constructor(e){super(),ve(this,e,Nr,Dr,ye,{back:0,next:1,changeStep:2})}}function Br(r){let e,t,n,s="Create your Fidelity Password?",a,i,o="Please choose at least 8 characters, including letters and numbers",c,u,h,p,_,m="Back",f,g,S,A,l;return{c(){e=x("div"),t=x("div"),n=x("h1"),n.textContent=s,a=D(),i=x("p"),i.textContent=o,c=D(),u=x("textarea"),h=D(),p=x("div"),_=x("button"),_.textContent=m,f=D(),g=x("button"),S=re("Next"),this.h()},l(d){e=C(d,"DIV",{class:!0});var y=E(e);t=C(y,"DIV",{class:!0});var b=E(t);n=C(b,"H1",{class:!0,"data-svelte-h":!0}),U(n)!=="svelte-1shi0ru"&&(n.textContent=s),a=N(b),i=C(b,"P",{class:!0,"data-svelte-h":!0}),U(i)!=="svelte-hluucs"&&(i.textContent=o),c=N(b),u=C(b,"TEXTAREA",{class:!0,rows:!0}),E(u).forEach(k),h=N(b),p=C(b,"DIV",{class:!0});var P=E(p);_=C(P,"BUTTON",{class:!0,"data-svelte-h":!0}),U(_)!=="svelte-1admezx"&&(_.textContent=m),f=N(P),g=C(P,"BUTTON",{class:!0});var T=E(g);S=ae(T,"Next"),T.forEach(k),P.forEach(k),b.forEach(k),y.forEach(k),this.h()},h(){v(n,"class","font-light"),v(i,"class","text-fidelity-neutral-500 my-3"),v(u,"class","single svelte-x99d95"),v(u,"rows","1"),v(_,"class","back"),v(g,"class","next"),g.disabled=r[5],v(p,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),v(t,"class","w-96 h-1/2 mx-auto text-center"),v(e,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(d,y){z(d,e,y),w(e,t),w(t,n),w(t,a),w(t,i),w(t,c),w(t,u),r[7](u),Ie(u,r[3].password),w(t,h),w(t,p),w(p,_),w(p,f),w(p,g),w(g,S),A||(l=[H(u,"input",r[8]),H(u,"keydown",r[9]),H(_,"click",r[10]),H(g,"click",r[11])],A=!0)},p(d,[y]){y&8&&Ie(u,d[3].password),y&32&&(g.disabled=d[5])},i:q,o:q,d(d){d&&k(e),r[7](null),A=!1,Jt(l)}}}function jr(r,e,t){let n,s;Me(r,ie,g=>t(3,s=g));let{back:a=""}=e,{next:i=""}=e,{changeStep:o=g=>{}}=e,c;Fe(()=>{_e.set(!0),c==null||c.focus(),window.scrollTo(0,0)});const u=g=>{g.key==="Enter"&&(g.preventDefault(),o(i))};function h(g){mn[g?"unshift":"push"](()=>{c=g,t(4,c)})}function p(){s.password=this.value,ie.set(s)}const _=g=>u(g),m=()=>o(a),f=()=>o(i);return r.$$set=g=>{"back"in g&&t(0,a=g.back),"next"in g&&t(1,i=g.next),"changeStep"in g&&t(2,o=g.changeStep)},r.$$.update=()=>{r.$$.dirty&8&&t(5,n=s.password?s.password.length<=4:!0)},[a,i,o,s,c,n,u,h,p,_,m,f]}class oa extends be{constructor(e){super(),ve(this,e,jr,Br,ye,{back:0,next:1,changeStep:2})}}function ns(r,e,t){const n=r.slice();return n[3]=e[t],n}function Lr(r){let e,t;return{c(){e=x("div"),t=x("div"),this.h()},l(n){e=C(n,"DIV",{class:!0});var s=E(e);t=C(s,"DIV",{class:!0,style:!0}),E(t).forEach(k),s.forEach(k),this.h()},h(){v(t,"class","h-full rounded-l-lg rounded-r-lg bg-fidelity-green-600"),On(t,"width",r[1]+"px"),v(e,"class","mt-6 h-8 w-[500px] rounded-lg border-[1px] bg-white mx-auto")},m(n,s){z(n,e,s),w(e,t)},p(n,s){s&2&&On(t,"width",n[1]+"px")},d(n){n&&k(e)}}}function Wr(r){let e,t=Te(r[0]),n=[];for(let s=0;s<t.length;s+=1)n[s]=ss(ns(r,t,s));return{c(){e=x("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=C(s,"DIV",{class:!0});var a=E(e);for(let i=0;i<n.length;i+=1)n[i].l(a);a.forEach(k),this.h()},h(){v(e,"class","mt-6 grid w-full grid-cols-3 gap-6")},m(s,a){z(s,e,a);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,a){if(a&1){t=Te(s[0]);let i;for(i=0;i<t.length;i+=1){const o=ns(s,t,i);n[i]?n[i].p(o,a):(n[i]=ss(o),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(s){s&&k(e),gn(n,s)}}}function ss(r){let e,t,n=r[3].name+"",s,a,i,o=r[3].rationale+"",c,u,h,p='<button class="bg-fidelity-green-600 text-white">Get Started</button>',_;return{c(){e=x("div"),t=x("div"),s=re(n),a=D(),i=x("div"),c=re(o),u=D(),h=x("div"),h.innerHTML=p,_=D(),this.h()},l(m){e=C(m,"DIV",{class:!0});var f=E(e);t=C(f,"DIV",{class:!0});var g=E(t);s=ae(g,n),g.forEach(k),a=N(f),i=C(f,"DIV",{class:!0});var S=E(i);c=ae(S,o),S.forEach(k),u=N(f),h=C(f,"DIV",{class:!0,"data-svelte-h":!0}),U(h)!=="svelte-1o6c58z"&&(h.innerHTML=p),_=N(f),f.forEach(k),this.h()},h(){v(t,"class","flex min-h-16 w-full items-center justify-center rounded-t-lg bg-fidelity-green-600 p-2 text-center text-white"),v(i,"class","h-64 w-full overflow-clip p-4 text-sm text-fidelity-neutral-600"),v(h,"class","flex justify-center p-4"),v(e,"class","w-full rounded-lg shadow-md")},m(m,f){z(m,e,f),w(e,t),w(t,s),w(e,a),w(e,i),w(i,c),w(e,u),w(e,h),w(e,_)},p(m,f){f&1&&n!==(n=m[3].name+"")&&_t(s,n),f&1&&o!==(o=m[3].rationale+"")&&_t(c,o)},d(m){m&&k(e)}}}function Ur(r){let e,t,n="Your Recommendations",s,a,i="Based on our conversation, these are the accounts we recommend",o;function c(p,_){return p[0].length>0?Wr:Lr}let u=c(r),h=u(r);return{c(){e=x("div"),t=x("h1"),t.textContent=n,s=D(),a=x("p"),a.textContent=i,o=D(),h.c(),this.h()},l(p){e=C(p,"DIV",{class:!0});var _=E(e);t=C(_,"H1",{class:!0,"data-svelte-h":!0}),U(t)!=="svelte-1uhmn4w"&&(t.textContent=n),s=N(_),a=C(_,"P",{class:!0,"data-svelte-h":!0}),U(a)!=="svelte-1cmmurr"&&(a.textContent=i),o=N(_),h.l(_),_.forEach(k),this.h()},h(){v(t,"class",""),v(a,"class","pt-4"),v(e,"class","mx-auto max-w-3xl py-8 text-center")},m(p,_){z(p,e,_),w(e,t),w(e,s),w(e,a),w(e,o),h.m(e,null)},p(p,[_]){u===(u=c(p))&&h?h.p(p,_):(h.d(1),h=u(p),h&&(h.c(),h.m(e,null)))},i:q,o:q,d(p){p&&k(e),h.d()}}}function qr(r,e,t){let n;Me(r,ie,i=>t(2,n=i));let s=[],a=0;return Fe(async()=>{console.log("Getting ready to summarize the following data.... ",n);const i=Or();let o=setInterval(()=>{t(1,a+=1),a===500&&(clearInterval(o),(async()=>{try{const c=await i;t(0,s=c.recommendations)}catch(c){console.error("Error fetching data:",c)}})())},20)}),[s,a]}class la extends be{constructor(e){super(),ve(this,e,qr,Ur,ye,{})}}function rs(r,e,t){const n=r.slice();return n[7]=e[t],n[9]=t,n}function as(r){let e,t=Te(r[0]),n=[];for(let s=0;s<t.length;s+=1)n[s]=is(rs(r,t,s));return{c(){e=x("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=C(s,"DIV",{class:!0});var a=E(e);for(let i=0;i<n.length;i+=1)n[i].l(a);a.forEach(k),this.h()},h(){v(e,"class","mx-auto flex h-24 flex-row items-center justify-center gap-3")},m(s,a){z(s,e,a);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,a){if(a&23){t=Te(s[0]);let i;for(i=0;i<t.length;i+=1){const o=rs(s,t,i);n[i]?n[i].p(o,a):(n[i]=is(o),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(s){s&&k(e),gn(n,s)}}}function is(r){let e,t=r[9]+1+"",n,s,a,i,o;function c(){return r[6](r[9])}return{c(){e=x("button"),n=re(t),s=D(),this.h()},l(u){e=C(u,"BUTTON",{class:!0});var h=E(e);n=ae(h,t),s=N(h),h.forEach(k),this.h()},h(){v(e,"class",a="circle "+(r[9]===r[1]?"current":r[9]<=r[2]?"last":"future")+" svelte-3sjztk")},m(u,h){z(u,e,h),w(e,n),w(e,s),i||(o=H(e,"click",c),i=!0)},p(u,h){r=u,h&6&&a!==(a="circle "+(r[9]===r[1]?"current":r[9]<=r[2]?"last":"future")+" svelte-3sjztk")&&v(e,"class",a)},d(u){u&&k(e),i=!1,o()}}}function Vr(r){let e,t=r[3]&&as(r);return{c(){t&&t.c(),e=Dn()},l(n){t&&t.l(n),e=Dn()},m(n,s){t&&t.m(n,s),z(n,e,s)},p(n,[s]){n[3]?t?t.p(n,s):(t=as(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:q,o:q,d(n){n&&k(e),t&&t.d(n)}}}function Hr(r,e,t){let n;Me(r,_e,h=>t(3,n=h));let{steps:s=[]}=e,{displayedStep:a=-1}=e,{maxStep:i=0}=e,{changeStep:o=h=>{}}=e;const c=h=>{h>i||h===a||o(h)},u=h=>c(h);return r.$$set=h=>{"steps"in h&&t(0,s=h.steps),"displayedStep"in h&&t(1,a=h.displayedStep),"maxStep"in h&&t(2,i=h.maxStep),"changeStep"in h&&t(5,o=h.changeStep)},[s,a,i,n,c,o,u]}class ca extends be{constructor(e){super(),ve(this,e,Hr,Vr,ye,{steps:0,displayedStep:1,maxStep:2,changeStep:5})}}export{ia as E,$r as G,Gr as I,Kr as N,oa as P,ca as S,la as a,Nn as f,aa as g};
