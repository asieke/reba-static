import{h as lr,s as me,n as q,o as xe,r as Re,c as fe,e as je,f as As,C as ht,t as or}from"../chunks/scheduler.BSOOe48D.js";import{S as ge,i as _e,e as x,s as M,c as k,a as R,d as A,f as D,k as L,l as C,g as W,h as w,E as B,t as Q,b as Y,C as We,F as kt,j as Ue,x as tn,q as be,v as nn,p as le,G as Es,H as Ps,D as Ce,u as Le,w as qn,m as fn,n as Rs,o as mn,r as gn,y as Xn}from"../chunks/index.CcPTrofP.js";import{e as ne}from"../chunks/each.D6YF6ztN.js";import{w as rt}from"../chunks/index.CcOTdpln.js";function At(r,{delay:e=0,duration:t=400,easing:n=lr}={}){const s=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:n,css:a=>`opacity: ${a*s}`}}const cr=()=>(console.log("HELLO: ",localStorage.getItem("openAIKey")||""),localStorage.getItem("openAIKey")||""),ur=rt(cr()),z=rt({}),Ae=rt([]),_n=rt(!1),ye=rt(!1);function hr(r){let e,t,n,s,a,i,c,o="Tell us about yourself",l,h,m=`We'll get to know you and we can personalize a plan for your finances, family, and goals.
					This should take only 5-10 minutes.`,b,d,f="Take the Quiz",g,S,y=`<p>Investment advisory services provided through Fidelity Personal and Workplace Advisors LLC,
				a registered investment adviser, for a fee. Brokerage services provided through Fidelity
				Brokerage Services LLC, Member NYSE, SIPC. Both are Fidelity Investments companies. The
				images, graphs, tools, and videos are for illustrative purposes only.</p> <p>Fidelity Brokerage Services LLC, Member NYSE, SIPC, 900 Salem Street, Smithfield, RI</p> <p>02917 782377.109.0</p>`,u,_;return{c(){e=x("div"),t=x("div"),n=M(),s=x("div"),a=x("div"),i=x("div"),c=x("h1"),c.textContent=o,l=M(),h=x("p"),h.textContent=m,b=M(),d=x("button"),d.textContent=f,g=M(),S=x("div"),S.innerHTML=y,this.h()},l(p){e=k(p,"DIV",{class:!0});var v=R(e);t=k(v,"DIV",{class:!0}),R(t).forEach(A),n=D(v),s=k(v,"DIV",{class:!0});var P=R(s);a=k(P,"DIV",{class:!0});var E=R(a);i=k(E,"DIV",{class:!0});var T=R(i);c=k(T,"H1",{class:!0,"data-svelte-h":!0}),L(c)!=="svelte-1lc6bui"&&(c.textContent=o),l=D(T),h=k(T,"P",{class:!0,"data-svelte-h":!0}),L(h)!=="svelte-ssohfm"&&(h.textContent=m),b=D(T),d=k(T,"BUTTON",{class:!0,"data-svelte-h":!0}),L(d)!=="svelte-1tinlz"&&(d.textContent=f),T.forEach(A),E.forEach(A),g=D(P),S=k(P,"DIV",{class:!0,"data-svelte-h":!0}),L(S)!=="svelte-3n41qz"&&(S.innerHTML=y),P.forEach(A),v.forEach(A),this.h()},h(){C(t,"class","min-h-[calc(100vh-112px)] picture svelte-xyzp20"),C(c,"class","font-light"),C(h,"class","my-4 font-light text-sm text-fidelity-neutral-600"),C(d,"class","bg-fidelity-green-600 text-white svelte-xyzp20"),C(i,"class","w-80"),C(a,"class","flex h-[calc(100%-150px)] items-center justify-center"),C(S,"class","h-[150px] text-[9px] p-8 space-y-3 text-fidelity-neutral-500"),C(s,"class","flex flex-col"),C(e,"class","grid grid-cols-2 w-full")},m(p,v){W(p,e,v),w(e,t),w(e,n),w(e,s),w(s,a),w(a,i),w(i,c),w(i,l),w(i,h),w(i,b),w(i,d),w(s,g),w(s,S),u||(_=B(d,"click",r[3]),u=!0)},p:q,i:q,o:q,d(p){p&&A(e),u=!1,_()}}}function dr(r,e,t){let{back:n}=e,{next:s}=e,{changeStep:a=c=>{}}=e;xe(()=>{console.log(n),ye.set(!1)});const i=()=>a(s);return r.$$set=c=>{"back"in c&&t(2,n=c.back),"next"in c&&t(0,s=c.next),"changeStep"in c&&t(1,a=c.changeStep)},[s,a,n,i]}class fr extends ge{constructor(e){super(),_e(this,e,dr,hr,me,{back:2,next:0,changeStep:1})}}function Hn(r,e,t){const n=r.slice();return n[10]=e[t],n[12]=t,n}function Jn(r){let e,t=r[10].label+"",n,s,a,i;function c(){return r[7](r[12])}return{c(){e=x("button"),n=Q(t),s=M(),this.h()},l(o){e=k(o,"BUTTON",{class:!0});var l=R(e);n=Y(l,t),s=D(l),l.forEach(A),this.h()},h(){C(e,"class","grid svelte-q9pajy"),kt(e,"selected",r[10].status)},m(o,l){W(o,e,l),w(e,n),w(e,s),a||(i=B(e,"click",c),a=!0)},p(o,l){r=o,l&8&&t!==(t=r[10].label+"")&&Ue(n,t),l&8&&kt(e,"selected",r[10].status)},d(o){o&&A(e),a=!1,i()}}}function mr(r){let e,t,n,s,a,i,c,o="How would you like to get started today?",l,h,m="Please select anything you would like to help you with:",b,d,f,g,S,y="Back",u,_,p,v,P,E=ne(r[3]),T=[];for(let O=0;O<E.length;O+=1)T[O]=Jn(Hn(r,E,O));return{c(){e=x("div"),t=x("div"),n=M(),s=x("div"),a=x("div"),i=x("div"),c=x("h1"),c.textContent=o,l=M(),h=x("p"),h.textContent=m,b=M(),d=x("div");for(let O=0;O<T.length;O+=1)T[O].c();f=M(),g=x("div"),S=x("button"),S.textContent=y,u=M(),_=x("button"),p=Q("Next"),this.h()},l(O){e=k(O,"DIV",{class:!0});var X=R(e);t=k(X,"DIV",{class:!0}),R(t).forEach(A),n=D(X),s=k(X,"DIV",{class:!0});var j=R(s);a=k(j,"DIV",{class:!0});var Ve=R(a);i=k(Ve,"DIV",{class:!0});var ve=R(i);c=k(ve,"H1",{class:!0,"data-svelte-h":!0}),L(c)!=="svelte-1c1n5sv"&&(c.textContent=o),l=D(ve),h=k(ve,"P",{class:!0,"data-svelte-h":!0}),L(h)!=="svelte-9dtfsf"&&(h.textContent=m),b=D(ve),d=k(ve,"DIV",{class:!0});var Un=R(d);for(let ln=0;ln<T.length;ln+=1)T[ln].l(Un);Un.forEach(A),f=D(ve),g=k(ve,"DIV",{class:!0});var it=R(g);S=k(it,"BUTTON",{class:!0,"data-svelte-h":!0}),L(S)!=="svelte-1admezx"&&(S.textContent=y),u=D(it),_=k(it,"BUTTON",{class:!0});var Vn=R(_);p=Y(Vn,"Next"),Vn.forEach(A),it.forEach(A),ve.forEach(A),Ve.forEach(A),j.forEach(A),X.forEach(A),this.h()},h(){C(t,"class","min-h-[calc(100vh-112px)] picture svelte-q9pajy"),C(c,"class","font-light text-center"),C(h,"class","my-4 font-light text-sm text-center text-fidelity-neutral-600"),C(d,"class","flex justify-center items-center flex-wrap gap-2"),C(S,"class","back"),C(_,"class","next"),_.disabled=r[4],C(g,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),C(i,"class","w-[80%] -mt-24"),C(a,"class","flex h-full items-center justify-center"),C(s,"class","flex flex-col"),C(e,"class","grid grid-cols-2 w-full")},m(O,X){W(O,e,X),w(e,t),w(e,n),w(e,s),w(s,a),w(a,i),w(i,c),w(i,l),w(i,h),w(i,b),w(i,d);for(let j=0;j<T.length;j+=1)T[j]&&T[j].m(d,null);w(i,f),w(i,g),w(g,S),w(g,u),w(g,_),w(_,p),v||(P=[B(S,"click",r[8]),B(_,"click",r[9])],v=!0)},p(O,[X]){if(X&40){E=ne(O[3]);let j;for(j=0;j<E.length;j+=1){const Ve=Hn(O,E,j);T[j]?T[j].p(Ve,X):(T[j]=Jn(Ve),T[j].c(),T[j].m(d,null))}for(;j<T.length;j+=1)T[j].d(1);T.length=E.length}X&16&&(_.disabled=O[4])},i:q,o:q,d(O){O&&A(e),We(T,O),v=!1,Re(P)}}}function gr(r,e,t){let n,s;fe(r,z,d=>t(6,s=d)),xe(()=>{ye.set(!1)});let{back:a}=e,{next:i}=e,{changeStep:c=d=>{}}=e,o=[{label:"Save for Retirement",status:0},{label:"Build Wealth",status:0},{label:"Save for College",status:0},{label:"Give to Charity",status:0},{label:"Create a Budget",status:0},{label:"Save for a Rainy Day",status:0},{label:"Buy a Home",status:0},{label:"Pay down Debt",status:0}].map(d=>({label:d.label,status:s.goals&&s.goals.includes(d.label)?1:0}));const l=d=>{t(3,o=o.map((f,g)=>d===g?{...f,status:f.status?0:1}:f)),z.update(f=>(f.goals=o.filter(g=>g.status).map(g=>g.label),f))},h=d=>l(d),m=()=>c(a),b=()=>c(i);return r.$$set=d=>{"back"in d&&t(0,a=d.back),"next"in d&&t(1,i=d.next),"changeStep"in d&&t(2,c=d.changeStep)},r.$$.update=()=>{r.$$.dirty&64&&t(4,n=!s.goals||s.goals.length===0)},[a,i,c,o,n,l,s,h,m,b]}class _r extends ge{constructor(e){super(),_e(this,e,gr,mr,me,{back:0,next:1,changeStep:2})}}function pr(r){let e;return{c(){e=x("div")},l(t){e=k(t,"DIV",{}),R(e).forEach(A)},m(t,n){W(t,e,n)},p:q,i:q,o:q,d(t){t&&A(e)}}}function wr(r){var h;let e,t,n,s=(((h=r[2].name)==null?void 0:h.split(" ")[0])||"")+"",a,i,c,o,l;return{c(){e=x("div"),t=x("h1"),n=Q("Nice to meet you "),a=Q(s),i=Q("!"),this.h()},l(m){e=k(m,"DIV",{});var b=R(e);t=k(b,"H1",{class:!0});var d=R(t);n=Y(d,"Nice to meet you "),a=Y(d,s),i=Y(d,"!"),d.forEach(A),b.forEach(A),this.h()},h(){C(t,"class","my-20 text-center text-fidelity-neutral-600 font-light")},m(m,b){W(m,e,b),w(e,t),w(t,n),w(t,a),w(t,i),l=!0},p(m,b){var d;(!l||b&4)&&s!==(s=(((d=m[2].name)==null?void 0:d.split(" ")[0])||"")+"")&&Ue(a,s)},i(m){l||(m&&As(()=>{l&&(o&&o.end(1),c=Es(e,At,{duration:1e3}),c.start())}),l=!0)},o(m){c&&c.invalidate(),m&&(o=Ps(e,At,{duration:500})),l=!1},d(m){m&&A(e),m&&o&&o.end()}}}function br(r){let e,t,n="What's your name",s,a,i="We'll use this to personalize your experience",c,o,l,h,m,b="Back",d,f,g,S,y;return{c(){e=x("div"),t=x("h1"),t.textContent=n,s=M(),a=x("p"),a.textContent=i,c=M(),o=x("textarea"),l=M(),h=x("div"),m=x("button"),m.textContent=b,d=M(),f=x("button"),g=Q("Next"),this.h()},l(u){e=k(u,"DIV",{class:!0});var _=R(e);t=k(_,"H1",{class:!0,"data-svelte-h":!0}),L(t)!=="svelte-1wflpqz"&&(t.textContent=n),s=D(_),a=k(_,"P",{class:!0,"data-svelte-h":!0}),L(a)!=="svelte-10g4aiz"&&(a.textContent=i),c=D(_),o=k(_,"TEXTAREA",{class:!0,rows:!0}),R(o).forEach(A),l=D(_),h=k(_,"DIV",{class:!0});var p=R(h);m=k(p,"BUTTON",{class:!0,"data-svelte-h":!0}),L(m)!=="svelte-1admezx"&&(m.textContent=b),d=D(p),f=k(p,"BUTTON",{class:!0});var v=R(f);g=Y(v,"Next"),v.forEach(A),p.forEach(A),_.forEach(A),this.h()},h(){C(t,"class","font-light"),C(a,"class","text-fidelity-neutral-500 my-3"),C(o,"class","single"),C(o,"rows","1"),C(m,"class","back"),C(f,"class","next"),f.disabled=r[5],C(h,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),C(e,"class","w-96 h-1/2 mx-auto text-center")},m(u,_){W(u,e,_),w(e,t),w(e,s),w(e,a),w(e,c),w(e,o),r[9](o),Ce(o,r[2].name),w(e,l),w(e,h),w(h,m),w(h,d),w(h,f),w(f,g),S||(y=[B(o,"input",r[10]),B(o,"keydown",r[11]),B(m,"click",r[12]),B(f,"click",r[7])],S=!0)},p(u,_){_&4&&Ce(o,u[2].name),_&32&&(f.disabled=u[5])},i:q,o:q,d(u){u&&A(e),r[9](null),S=!1,Re(y)}}}function yr(r){let e,t,n;const s=[br,wr,pr],a=[];function i(c,o){return c[4]==="form"?0:c[4]==="welcome"?1:2}return t=i(r),n=a[t]=s[t](r),{c(){e=x("div"),n.c(),this.h()},l(c){e=k(c,"DIV",{class:!0});var o=R(e);n.l(o),o.forEach(A),this.h()},h(){C(e,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(c,o){W(c,e,o),a[t].m(e,null)},p(c,[o]){let l=t;t=i(c),t===l?a[t].p(c,o):(tn(),be(a[l],1,1,()=>{a[l]=null}),nn(),n=a[t],n?n.p(c,o):(n=a[t]=s[t](c),n.c()),le(n,1),n.m(e,null))},i(c){le(n)},o(c){be(n)},d(c){c&&A(e),a[t].d()}}}function vr(r,e,t){let n,s;fe(r,z,y=>t(2,s=y));let{back:a}=e,{next:i}=e,{changeStep:c=y=>{}}=e,o,l=!0,h="form";xe(()=>{ye.set(!0),s.name&&(l=!1),console.log(s),o==null||o.focus(),window.scrollTo(0,0)});const m=y=>{console.log(n),y.key==="Enter"&&(y.preventDefault(),b())},b=()=>{l?(ye.set(!1),t(4,h="welcome"),setTimeout(()=>{t(4,h="")},2250),setTimeout(()=>{c(i)},2500)):c(i)};function d(y){je[y?"unshift":"push"](()=>{o=y,t(3,o)})}function f(){s.name=this.value,z.set(s)}const g=y=>m(y),S=()=>c(a);return r.$$set=y=>{"back"in y&&t(0,a=y.back),"next"in y&&t(8,i=y.next),"changeStep"in y&&t(1,c=y.changeStep)},r.$$.update=()=>{r.$$.dirty&4&&t(5,n=s.name?s.name.length<=4:!0)},[a,c,s,o,h,n,m,b,i,d,f,g,S]}class Sr extends ge{constructor(e){super(),_e(this,e,vr,yr,me,{back:0,next:8,changeStep:1})}}const Ie="4.45.0";let zn=!1,$e,Is,Ts,pn,Os,Ms,Ds,Fs,Ns;function Cr(r,e={auto:!1}){if(zn)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if($e)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${$e}'\``);zn=e.auto,$e=r.kind,Is=r.fetch,Ts=r.FormData,pn=r.File,Os=r.ReadableStream,Ms=r.getMultipartRequestOptions,Ds=r.getDefaultAgent,Fs=r.fileFromPath,Ns=r.isFsReadStream}class xr{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function kr({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,a;try{t=fetch,n=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,c)=>({...c,body:new xr(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}$e||Cr(kr(),{auto:!0});class N extends Error{}class K extends N{constructor(e,t,n,s){super(`${K.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"];const a=t;this.error=a,this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e)return new sn({cause:bn(t)});const a=t==null?void 0:t.error;return e===400?new Bs(e,a,n,s):e===401?new js(e,a,n,s):e===403?new Ls(e,a,n,s):e===404?new Ws(e,a,n,s):e===409?new Us(e,a,n,s):e===422?new Vs(e,a,n,s):e===429?new qs(e,a,n,s):e>=500?new Xs(e,a,n,s):new K(e,a,n,s)}}class ee extends K{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class sn extends K{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Pn extends sn{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Bs extends K{constructor(){super(...arguments),this.status=400}}class js extends K{constructor(){super(...arguments),this.status=401}}class Ls extends K{constructor(){super(...arguments),this.status=403}}class Ws extends K{constructor(){super(...arguments),this.status=404}}class Us extends K{constructor(){super(...arguments),this.status=409}}class Vs extends K{constructor(){super(...arguments),this.status=422}}class qs extends K{constructor(){super(...arguments),this.status=429}}class Xs extends K{}class de{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of Ar(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null){let c;try{c=JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(c&&c.error)throw new K(void 0,c.error,void 0,void 0);yield c}else{let c;try{c=JSON.parse(i.data)}catch(o){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),o}if(i.event=="error")throw new K(void 0,c.error,c.message,void 0);yield{event:i.event,data:c}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new de(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new Pe,c=Hs(e);for await(const o of c)for(const l of i.decode(o))yield l;for(const o of i.flush())yield o}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const c of s())i||c&&(yield JSON.parse(c));i=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{i||t.abort()}}return new de(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new de(()=>s(e),this.controller),new de(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Os({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await t.next();if(i)return s.close();const c=n.encode(JSON.stringify(a)+`
`);s.enqueue(c)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Ar(r,e){if(!r.body)throw e.abort(),new N("Attempted to iterate over a response with no body");const t=new Rr,n=new Pe,s=Hs(r.body);for await(const a of Er(s))for(const i of n.decode(a)){const c=t.decode(i);c&&(yield c)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Er(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=Pr(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function Pr(r){for(let n=0;n<r.length-2;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}class Rr{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=Ir(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}class Pe{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=Pe.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(Pe.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new N(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new N(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new N("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Pe.NEWLINE_CHARS=new Set([`
`,"\r"]);Pe.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ir(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function Hs(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Js=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",zs=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Ks(r),Ks=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Tr=r=>zs(r)||Js(r)||Ns(r);async function Gs(r,e,t){var s;if(r=await r,t??(t=zs(r)?{lastModified:r.lastModified,type:r.type}:{}),Js(r)){const a=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new pn([a],e,t)}const n=await Or(r);if(e||(e=Dr(r)??"unknown_file"),!t.type){const a=(s=n[0])==null?void 0:s.type;typeof a=="string"&&(t={...t,type:a})}return new pn(n,e,t)}async function Or(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Ks(r))e.push(await r.arrayBuffer());else if(Fr(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${Mr(r)}`);return e}function Mr(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Dr(r){var e;return on(r.name)||on(r.filename)||((e=on(r.path))==null?void 0:e.split(/[\\/]/).pop())}const on=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Fr=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Kn=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",tt=async r=>{const e=await Nr(r.body);return Ms(e,r)},Nr=async r=>{const e=new Ts;return await Promise.all(Object.entries(r||{}).map(([t,n])=>wn(e,t,n))),e},wn=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(Tr(t)){const n=await Gs(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>wn(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>wn(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var De={},Br=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},jr=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},lt;async function Qs(r){const{response:e}=r;if(r.options.stream)return Fe("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):de.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const a=await e.json();return Fe("response",e.status,e.url,e.headers,a),a}const s=await e.text();return Fe("response",e.status,e.url,e.headers,s),s}class rn extends Promise{constructor(e,t=Qs){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new rn(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Lr{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=cn("maxRetries",t),this.timeout=cn("timeout",n),this.httpAgent=s,this.fetch=a??Is}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Hr(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Gr()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var f;const{method:t,path:n,query:s,headers:a={}}=e,i=Kn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(i),o=this.buildURL(n,s);"timeout"in e&&cn("timeout",e.timeout);const l=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??Ds(o),m=l+1e3;typeof((f=h==null?void 0:h.options)==null?void 0:f.timeout)=="number"&&m>(h.options.timeout??0)&&(h.options.timeout=m),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const b=this.buildHeaders({options:e,headers:a,contentLength:c});return{req:{method:t,...i&&{body:i},headers:b,...h&&{agent:h},signal:e.signal??null},url:o,timeout:l}}buildHeaders({options:e,headers:t,contentLength:n}){const s={};n&&(s["content-length"]=n);const a=this.defaultHeaders(e);return Zn(s,a),Zn(s,t),Kn(e.body)&&$e!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return K.generate(e,t,n,s)}request(e,t=null){return new rn(this.makeRequest(e,t))}async makeRequest(e,t){var h,m;const n=await e;t==null&&(t=n.maxRetries??this.maxRetries),await this.prepareOptions(n);const{req:s,url:a,timeout:i}=this.buildRequest(n);if(await this.prepareRequest(s,{url:a,options:n}),Fe("request",a,n,s.headers),(h=n.signal)!=null&&h.aborted)throw new ee;const c=new AbortController,o=await this.fetchWithTimeout(a,s,i,c).catch(bn);if(o instanceof Error){if((m=n.signal)!=null&&m.aborted)throw new ee;if(t)return this.retryRequest(n,t);throw o.name==="AbortError"?new Pn:new sn({cause:o})}const l=Ur(o.headers);if(!o.ok){if(t&&this.shouldRetry(o)){const y=`retrying, ${t} attempts remaining`;return Fe(`response (error; ${y})`,o.status,a,l),this.retryRequest(n,t,l)}const b=await o.text().catch(y=>bn(y).message),d=Jr(b),f=d?void 0:b;throw Fe(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,o.status,a,l,f),this.makeStatusError(o.status,d,f,l)}return{response:o,options:n,controller:c}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Wr(this,n,e)}buildURL(e,t){const n=Kr(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Zs(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new N(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());const c=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(c)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const a=n==null?void 0:n["retry-after-ms"];if(a){const c=parseFloat(a);Number.isNaN(c)||(s=c)}const i=n==null?void 0:n["retry-after"];if(i&&!s){const c=parseFloat(i);Number.isNaN(c)?s=Date.parse(i)-Date.now():s=c*1e3}if(!(s&&0<=s&&s<60*1e3)){const c=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,c)}return await at(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),c=1-Math.random()*.25;return i*c*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ie}`}}class Ys{constructor(e,t,n,s){lt.set(this,void 0),Br(this,lt,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new N("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,a]of n)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await jr(this,lt,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(lt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Wr extends rn{constructor(e,t,n){super(t,async s=>new n(e,s.response,await Qs(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Ur=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Vr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},te=r=>typeof r=="object"&&r!==null&&!Zs(r)&&Object.keys(r).every(e=>$s(Vr,e)),qr=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":Qn(Deno.build.os),"X-Stainless-Arch":Gn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":Qn(process.platform),"X-Stainless-Arch":Gn(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=Xr();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Xr(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const Gn=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Qn=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Yn;const Hr=()=>Yn??(Yn=qr()),Jr=r=>{try{return JSON.parse(r)}catch{return}},zr=new RegExp("^(?:[a-z]+:)?//","i"),Kr=r=>zr.test(r),at=r=>new Promise(e=>setTimeout(e,r)),cn=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new N(`${r} must be an integer`);if(e<0)throw new N(`${r} must be a positive integer`);return e},bn=r=>r instanceof Error?r:new Error(r),ot=r=>{var e,t,n,s;if(typeof process<"u")return((e=De==null?void 0:De[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function Zs(r){if(!r)return!0;for(const e in r)return!1;return!0}function $s(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Zn(r,e){for(const t in e){if(!$s(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function Fe(r,...e){typeof process<"u"&&(De==null?void 0:De.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${r}`,...e)}const Gr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),Qr=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function $n(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}let Rn=class extends Ys{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};class ce extends Ys{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class U{constructor(e){this._client=e}}let Et=class extends U{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};Et||(Et={});let Pt=class extends U{constructor(){super(...arguments),this.completions=new Et(this._client)}};(function(r){r.Completions=Et})(Pt||(Pt={}));class Rt extends U{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Rt||(Rt={});class It extends U{create(e,t){return this._client.post("/audio/transcriptions",tt({body:e,...t}))}}It||(It={});class Tt extends U{create(e,t){return this._client.post("/audio/translations",tt({body:e,...t}))}}Tt||(Tt={});class Ot extends U{constructor(){super(...arguments),this.transcriptions=new It(this._client),this.translations=new Tt(this._client),this.speech=new Rt(this._client)}}(function(r){r.Transcriptions=It,r.Translations=Tt,r.Speech=Rt})(Ot||(Ot={}));class Mt extends U{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return te(e)?this.list({},e):this._client.getAPIList("/batches",In,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class In extends ce{}(function(r){r.BatchesPage=In})(Mt||(Mt={}));class Dt extends U{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return te(e)?this.list({},e):this._client.getAPIList("/assistants",Tn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Tn extends ce{}(function(r){r.AssistantsPage=Tn})(Dt||(Dt={}));function es(r){return typeof r.parse=="function"}const Ne=r=>(r==null?void 0:r.role)==="assistant",er=r=>(r==null?void 0:r.role)==="function",tr=r=>(r==null?void 0:r.role)==="tool";var se=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},F=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},G,dt,ft,qe,Xe,mt,He,pe,Je,gt,_t,Te,yn,Ft,vn,Sn,Cn,xn,nr,kn;const ts=10;class sr{constructor(){G.add(this),this.controller=new AbortController,dt.set(this,void 0),ft.set(this,()=>{}),qe.set(this,()=>{}),Xe.set(this,void 0),mt.set(this,()=>{}),He.set(this,()=>{}),pe.set(this,{}),this._chatCompletions=[],this.messages=[],Je.set(this,!1),gt.set(this,!1),_t.set(this,!1),Te.set(this,!1),xn.set(this,e=>{if(se(this,gt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ee),e instanceof ee)return se(this,_t,!0,"f"),this._emit("abort",e);if(e instanceof N)return this._emit("error",e);if(e instanceof Error){const t=new N(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new N(String(e)))}),se(this,dt,new Promise((e,t)=>{se(this,ft,e,"f"),se(this,qe,t,"f")}),"f"),se(this,Xe,new Promise((e,t)=>{se(this,mt,e,"f"),se(this,He,t,"f")}),"f"),F(this,dt,"f").catch(()=>{}),F(this,Xe,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},F(this,xn,"f"))},0)}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(er(e)||tr(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ne(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ne(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}_connected(){this.ended||(F(this,ft,"f").call(this),this._emit("connect"))}get ended(){return F(this,Je,"f")}get errored(){return F(this,gt,"f")}get aborted(){return F(this,_t,"f")}abort(){this.controller.abort()}on(e,t){return(F(this,pe,"f")[e]||(F(this,pe,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=F(this,pe,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(F(this,pe,"f")[e]||(F(this,pe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{se(this,Te,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){se(this,Te,!0,"f"),await F(this,Xe,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new N("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),F(this,G,"m",yn).call(this)}async finalMessage(){return await this.done(),F(this,G,"m",Ft).call(this)}async finalFunctionCall(){return await this.done(),F(this,G,"m",vn).call(this)}async finalFunctionCallResult(){return await this.done(),F(this,G,"m",Sn).call(this)}async totalUsage(){return await this.done(),F(this,G,"m",Cn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(F(this,Je,"f"))return;e==="end"&&(se(this,Je,!0,"f"),F(this,mt,"f").call(this));const n=F(this,pe,"f")[e];if(n&&(F(this,pe,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!F(this,Te,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,qe,"f").call(this,s),F(this,He,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!F(this,Te,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,qe,"f").call(this,s),F(this,He,"f").call(this,s),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=F(this,G,"m",Ft).call(this);t&&this._emit("finalMessage",t);const n=F(this,G,"m",yn).call(this);n&&this._emit("finalContent",n);const s=F(this,G,"m",vn).call(this);s&&this._emit("finalFunctionCall",s);const a=F(this,G,"m",Sn).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",F(this,G,"m",Cn).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),F(this,G,"m",nr).call(this,t);const a=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(a)}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var b;const s="function",{function_call:a="auto",stream:i,...c}=t,o=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:l=ts}=n||{},h={};for(const d of t.functions)h[d.name||d.function.name]=d;const m=t.functions.map(d=>({name:d.name||d.function.name,parameters:d.parameters,description:d.description}));for(const d of t.messages)this._addMessage(d,!1);for(let d=0;d<l;++d){const g=(b=(await this._createChatCompletion(e,{...c,function_call:a,functions:m,messages:[...this.messages]},n)).choices[0])==null?void 0:b.message;if(!g)throw new N("missing message in ChatCompletion response");if(!g.function_call)return;const{name:S,arguments:y}=g.function_call,u=h[S];if(u){if(o&&o!==S){const P=`Invalid function_call: ${JSON.stringify(S)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:s,name:S,content:P});continue}}else{const P=`Invalid function_call: ${JSON.stringify(S)}. Available options are: ${m.map(E=>JSON.stringify(E.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:S,content:P});continue}let _;try{_=es(u)?await u.parse(y):y}catch(P){this._addMessage({role:s,name:S,content:P instanceof Error?P.message:String(P)});continue}const p=await u.function(_,this),v=F(this,G,"m",kn).call(this,p);if(this._addMessage({role:s,name:S,content:v}),o)return}}async _runTools(e,t,n){var b,d;const s="tool",{tool_choice:a="auto",stream:i,...c}=t,o=typeof a!="string"&&((b=a==null?void 0:a.function)==null?void 0:b.name),{maxChatCompletions:l=ts}=n||{},h={};for(const f of t.tools)f.type==="function"&&(h[f.function.name||f.function.function.name]=f.function);const m="tools"in t?t.tools.map(f=>f.type==="function"?{type:"function",function:{name:f.function.name||f.function.function.name,parameters:f.function.parameters,description:f.function.description}}:f):void 0;for(const f of t.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){const S=(d=(await this._createChatCompletion(e,{...c,tool_choice:a,tools:m,messages:[...this.messages]},n)).choices[0])==null?void 0:d.message;if(!S)throw new N("missing message in ChatCompletion response");if(!S.tool_calls)return;for(const y of S.tool_calls){if(y.type!=="function")continue;const u=y.id,{name:_,arguments:p}=y.function,v=h[_];if(v){if(o&&o!==_){const O=`Invalid tool_call: ${JSON.stringify(_)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:s,tool_call_id:u,content:O});continue}}else{const O=`Invalid tool_call: ${JSON.stringify(_)}. Available options are: ${m.map(X=>JSON.stringify(X.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:u,content:O});continue}let P;try{P=es(v)?await v.parse(p):p}catch(O){const X=O instanceof Error?O.message:String(O);this._addMessage({role:s,tool_call_id:u,content:X});continue}const E=await v.function(P,this),T=F(this,G,"m",kn).call(this,E);if(this._addMessage({role:s,tool_call_id:u,content:T}),o)return}}}}dt=new WeakMap,ft=new WeakMap,qe=new WeakMap,Xe=new WeakMap,mt=new WeakMap,He=new WeakMap,pe=new WeakMap,Je=new WeakMap,gt=new WeakMap,_t=new WeakMap,Te=new WeakMap,xn=new WeakMap,G=new WeakSet,yn=function(){return F(this,G,"m",Ft).call(this).content??null},Ft=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Ne(t))return{...t,content:t.content??null}}throw new N("stream ended without producing a ChatCompletionMessage with role=assistant")},vn=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(Ne(s)&&(s!=null&&s.function_call))return s.function_call;if(Ne(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},Sn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(er(t)&&t.content!=null||tr(t)&&t.content!=null&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Cn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},nr=function(e){if(e.n!=null&&e.n>1)throw new N("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},kn=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class nt extends sr{static runFunctions(e,t,n){const s=new nt,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new nt,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e){super._addMessage(e),Ne(e)&&e.content&&this._emit("content",e.content)}}var re=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},un=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ue,Se,hn,dn,ct,ns;class st extends sr{constructor(){super(...arguments),ue.add(this),Se.set(this,void 0)}get currentChatCompletionSnapshot(){return re(this,Se,"f")}static fromReadableStream(e){const t=new st;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new st;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var i;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),re(this,ue,"m",hn).call(this);const a=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const c of a)re(this,ue,"m",dn).call(this,c);if((i=a.controller.signal)!=null&&i.aborted)throw new ee;return this._addChatCompletion(re(this,ue,"m",ct).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),re(this,ue,"m",hn).call(this),this._connected();const s=de.fromReadableStream(e,this.controller);let a;for await(const c of s)a&&a!==c.id&&this._addChatCompletion(re(this,ue,"m",ct).call(this)),re(this,ue,"m",dn).call(this,c),a=c.id;if((i=s.controller.signal)!=null&&i.aborted)throw new ee;return this._addChatCompletion(re(this,ue,"m",ct).call(this))}[(Se=new WeakMap,ue=new WeakSet,hn=function(){this.ended||un(this,Se,void 0,"f")},dn=function(t){var i,c,o;if(this.ended)return;const n=re(this,ue,"m",ns).call(this,t);this._emit("chunk",t,n);const s=(c=(i=t.choices[0])==null?void 0:i.delta)==null?void 0:c.content,a=(o=n.choices[0])==null?void 0:o.message;s!=null&&(a==null?void 0:a.role)==="assistant"&&(a!=null&&a.content)&&this._emit("content",s,a.content)},ct=function(){if(this.ended)throw new N("stream has ended, this shouldn't happen");const t=re(this,Se,"f");if(!t)throw new N("request ended without sending any chunks");return un(this,Se,void 0,"f"),Yr(t)},ns=function(t){var n,s,a;let i=re(this,Se,"f");const{choices:c,...o}=t;i?Object.assign(i,o):i=un(this,Se,{...o,choices:[]},"f");for(const{delta:l,finish_reason:h,index:m,logprobs:b=null,...d}of t.choices){let f=i.choices[m];if(f||(f=i.choices[m]={finish_reason:h,index:m,message:{},logprobs:b,...d}),b)if(!f.logprobs)f.logprobs=Object.assign({},b);else{const{content:p,...v}=b;Object.assign(f.logprobs,v),p&&((n=f.logprobs).content??(n.content=[]),f.logprobs.content.push(...p))}if(h&&(f.finish_reason=h),Object.assign(f,d),!l)continue;const{content:g,function_call:S,role:y,tool_calls:u,..._}=l;if(Object.assign(f.message,_),g&&(f.message.content=(f.message.content||"")+g),y&&(f.message.role=y),S&&(f.message.function_call?(S.name&&(f.message.function_call.name=S.name),S.arguments&&((s=f.message.function_call).arguments??(s.arguments=""),f.message.function_call.arguments+=S.arguments)):f.message.function_call=S),u){f.message.tool_calls||(f.message.tool_calls=[]);for(const{index:p,id:v,type:P,function:E,...T}of u){const O=(a=f.message.tool_calls)[p]??(a[p]={});Object.assign(O,T),v&&(O.id=v),P&&(O.type=P),E&&(O.function??(O.function={arguments:""})),E!=null&&E.name&&(O.function.name=E.name),E!=null&&E.arguments&&(O.function.arguments+=E.arguments)}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new de(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Yr(r){const{id:e,choices:t,created:n,model:s,system_fingerprint:a,...i}=r;return{...i,id:e,choices:t.map(({message:c,finish_reason:o,index:l,logprobs:h,...m})=>{if(!o)throw new N(`missing finish_reason for choice ${l}`);const{content:b=null,function_call:d,tool_calls:f,...g}=c,S=c.role;if(!S)throw new N(`missing role for choice ${l}`);if(d){const{arguments:y,name:u}=d;if(y==null)throw new N(`missing function_call.arguments for choice ${l}`);if(!u)throw new N(`missing function_call.name for choice ${l}`);return{...m,message:{content:b,function_call:{arguments:y,name:u},role:S},finish_reason:o,index:l,logprobs:h}}return f?{...m,index:l,finish_reason:o,logprobs:h,message:{...g,role:S,content:b,tool_calls:f.map((y,u)=>{const{function:_,type:p,id:v,...P}=y,{arguments:E,name:T,...O}=_||{};if(v==null)throw new N(`missing choices[${l}].tool_calls[${u}].id
${ut(r)}`);if(p==null)throw new N(`missing choices[${l}].tool_calls[${u}].type
${ut(r)}`);if(T==null)throw new N(`missing choices[${l}].tool_calls[${u}].function.name
${ut(r)}`);if(E==null)throw new N(`missing choices[${l}].tool_calls[${u}].function.arguments
${ut(r)}`);return{...P,id:v,type:p,function:{...O,name:T,arguments:E}}})}}:{...m,message:{...g,content:b,role:S},finish_reason:o,index:l,logprobs:h}}),created:n,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}}}function ut(r){return JSON.stringify(r)}class Be extends st{static fromReadableStream(e){const t=new Be;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new Be,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new Be,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}}let rr=class extends U{runFunctions(e,t){return e.stream?Be.runFunctions(this._client.chat.completions,e,t):nt.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?Be.runTools(this._client.chat.completions,e,t):nt.runTools(this._client.chat.completions,e,t)}stream(e,t){return st.createChatCompletion(this._client.chat.completions,e,t)}},Nt=class extends U{constructor(){super(...arguments),this.completions=new rr(this._client)}};(function(r){r.Completions=rr})(Nt||(Nt={}));var ae=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},V=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},pt,wt,ze,Ke,bt,Ge,we,Qe,yt,vt,Oe,An;class Zr{constructor(){this.controller=new AbortController,pt.set(this,void 0),wt.set(this,()=>{}),ze.set(this,()=>{}),Ke.set(this,void 0),bt.set(this,()=>{}),Ge.set(this,()=>{}),we.set(this,{}),Qe.set(this,!1),yt.set(this,!1),vt.set(this,!1),Oe.set(this,!1),An.set(this,e=>{if(ae(this,yt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ee),e instanceof ee)return ae(this,vt,!0,"f"),this._emit("abort",e);if(e instanceof N)return this._emit("error",e);if(e instanceof Error){const t=new N(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new N(String(e)))}),ae(this,pt,new Promise((e,t)=>{ae(this,wt,e,"f"),ae(this,ze,t,"f")}),"f"),ae(this,Ke,new Promise((e,t)=>{ae(this,bt,e,"f"),ae(this,Ge,t,"f")}),"f"),V(this,pt,"f").catch(()=>{}),V(this,Ke,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},V(this,An,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(V(this,wt,"f").call(this),this._emit("connect"))}get ended(){return V(this,Qe,"f")}get errored(){return V(this,yt,"f")}get aborted(){return V(this,vt,"f")}abort(){this.controller.abort()}on(e,t){return(V(this,we,"f")[e]||(V(this,we,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=V(this,we,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(V(this,we,"f")[e]||(V(this,we,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{ae(this,Oe,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){ae(this,Oe,!0,"f"),await V(this,Ke,"f")}_emit(e,...t){if(V(this,Qe,"f"))return;e==="end"&&(ae(this,Qe,!0,"f"),V(this,bt,"f").call(this));const n=V(this,we,"f")[e];if(n&&(V(this,we,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!V(this,Oe,"f")&&!(n!=null&&n.length)&&Promise.reject(s),V(this,ze,"f").call(this,s),V(this,Ge,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!V(this,Oe,"f")&&!(n!=null&&n.length)&&Promise.reject(s),V(this,ze,"f").call(this,s),V(this,Ge,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,a){return await this._createToolAssistantStream(n,e,t,s,a)}async _createThreadAssistantStream(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a=await e.createAndRun({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(a)}async _createToolAssistantStream(e,t,n,s,a){const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const c=await e.submitToolOutputs(t,n,{...s,stream:!1},{...a,signal:this.controller.signal});return this._connected(),this._addRun(c)}async _createAssistantStream(e,t,n,s){const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i=await e.create(t,{...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(i)}}pt=new WeakMap,wt=new WeakMap,ze=new WeakMap,Ke=new WeakMap,bt=new WeakMap,Ge=new WeakMap,we=new WeakMap,Qe=new WeakMap,yt=new WeakMap,vt=new WeakMap,Oe=new WeakMap,An=new WeakMap;var I=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Z=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},J,En,he,St,ie,Ee,Me,ke,Bt,$,Ct,xt,et,Ye,Ze,ss,rs,as,is,ls,os,cs;class oe extends Zr{constructor(){super(...arguments),J.add(this),En.set(this,[]),he.set(this,{}),St.set(this,{}),ie.set(this,void 0),Ee.set(this,void 0),Me.set(this,void 0),ke.set(this,void 0),Bt.set(this,void 0),$.set(this,void 0),Ct.set(this,void 0),xt.set(this,void 0),et.set(this,void 0)}[(En=new WeakMap,he=new WeakMap,St=new WeakMap,ie=new WeakMap,Ee=new WeakMap,Me=new WeakMap,ke=new WeakMap,Bt=new WeakMap,$=new WeakMap,Ct=new WeakMap,xt=new WeakMap,et=new WeakMap,J=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new oe;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=de.fromReadableStream(e,this.controller);for await(const i of s)I(this,J,"m",Ye).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new ee;return this._addRun(I(this,J,"m",Ze).call(this))}toReadableStream(){return new de(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,a){const i=new oe;return i._run(()=>i._runToolAssistantStream(e,t,n,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,s,a){var l;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const c={...s,stream:!0},o=await e.submitToolOutputs(t,n,c,{...a,signal:this.controller.signal});this._connected();for await(const h of o)I(this,J,"m",Ye).call(this,h);if((l=o.controller.signal)!=null&&l.aborted)throw new ee;return this._addRun(I(this,J,"m",Ze).call(this))}static createThreadAssistantStream(e,t,n){const s=new oe;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const a=new oe;return a._run(()=>a._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return I(this,Ct,"f")}currentRun(){return I(this,xt,"f")}currentMessageSnapshot(){return I(this,ie,"f")}currentRunStepSnapshot(){return I(this,et,"f")}async finalRunSteps(){return await this.done(),Object.values(I(this,he,"f"))}async finalMessages(){return await this.done(),Object.values(I(this,St,"f"))}async finalRun(){if(await this.done(),!I(this,Ee,"f"))throw Error("Final run was not received.");return I(this,Ee,"f")}async _createThreadAssistantStream(e,t,n){var c;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const o of i)I(this,J,"m",Ye).call(this,o);if((c=i.controller.signal)!=null&&c.aborted)throw new ee;return this._addRun(I(this,J,"m",Ze).call(this))}async _createAssistantStream(e,t,n,s){var o;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},c=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(const l of c)I(this,J,"m",Ye).call(this,l);if((o=c.controller.signal)!=null&&o.aborted)throw new ee;return this._addRun(I(this,J,"m",Ze).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if($n(a)&&$n(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}}Ye=function(e){if(!this.ended)switch(Z(this,Ct,e,"f"),I(this,J,"m",as).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":I(this,J,"m",cs).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":I(this,J,"m",rs).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":I(this,J,"m",ss).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ze=function(){if(this.ended)throw new N("stream has ended, this shouldn't happen");if(!I(this,Ee,"f"))throw Error("Final run has not been received");return I(this,Ee,"f")},ss=function(e){const[t,n]=I(this,J,"m",ls).call(this,e,I(this,ie,"f"));Z(this,ie,t,"f"),I(this,St,"f")[t.id]=t;for(const s of n){const a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=I(this,Me,"f")){if(I(this,ke,"f"))switch(I(this,ke,"f").type){case"text":this._emit("textDone",I(this,ke,"f").text,I(this,ie,"f"));break;case"image_file":this._emit("imageFileDone",I(this,ke,"f").image_file,I(this,ie,"f"));break}Z(this,Me,s.index,"f")}Z(this,ke,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(I(this,Me,"f")!==void 0){const s=e.data.content[I(this,Me,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,I(this,ie,"f"));break;case"text":this._emit("textDone",s.text,I(this,ie,"f"));break}}I(this,ie,"f")&&this._emit("messageDone",e.data),Z(this,ie,void 0,"f")}},rs=function(e){const t=I(this,J,"m",is).call(this,e);switch(Z(this,et,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==I(this,Bt,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(I(this,$,"f")&&this._emit("toolCallDone",I(this,$,"f")),Z(this,Bt,a.index,"f"),Z(this,$,t.step_details.tool_calls[a.index],"f"),I(this,$,"f")&&this._emit("toolCallCreated",I(this,$,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Z(this,et,void 0,"f"),e.data.step_details.type=="tool_calls"&&I(this,$,"f")&&(this._emit("toolCallDone",I(this,$,"f")),Z(this,$,void 0,"f")),this._emit("runStepDone",e.data,t);break}},as=function(e){I(this,En,"f").push(e),this._emit("event",e)},is=function(e){switch(e.event){case"thread.run.step.created":return I(this,he,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=I(this,he,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=oe.accumulateDelta(t,n.delta);I(this,he,"f")[e.data.id]=s}return I(this,he,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":I(this,he,"f")[e.data.id]=e.data;break}if(I(this,he,"f")[e.data.id])return I(this,he,"f")[e.data.id];throw new Error("No snapshot available")},ls=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=I(this,J,"m",os).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},os=function(e,t){return oe.accumulateDelta(t,e)},cs=function(e){switch(Z(this,xt,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Z(this,Ee,e.data,"f"),I(this,$,"f")&&(this._emit("toolCallDone",I(this,$,"f")),Z(this,$,void 0,"f"));break}};class jt extends U{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return te(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,On,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class On extends ce{}(function(r){r.MessagesPage=On})(jt||(jt={}));class Lt extends U{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t,n={},s){return te(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Mn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Mn extends ce{}(function(r){r.RunStepsPage=Mn})(Lt||(Lt={}));class Wt extends U{constructor(){super(...arguments),this.steps=new Lt(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return te(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Dn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return oe.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const o=i.headers.get("openai-poll-after-ms");if(o){const l=parseInt(o);isNaN(l)||(c=l)}}await at(c);break;case"requires_action":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return oe.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const a=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,n,s){return oe.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class Dn extends ce{}(function(r){r.RunsPage=Dn,r.Steps=Lt,r.RunStepsPage=Mn})(Wt||(Wt={}));class Ut extends U{constructor(){super(...arguments),this.runs=new Wt(this._client),this.messages=new jt(this._client)}create(e={},t){return te(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return oe.createThreadAssistantStream(e,this._client.beta.threads,t)}}(function(r){r.Runs=Wt,r.RunsPage=Dn,r.Messages=jt,r.MessagesPage=On})(Ut||(Ut={}));const $r=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};let Vt=class extends U{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},n){return te(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,an,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const o=a.response.headers.get("openai-poll-after-ms");if(o){const l=parseInt(o);isNaN(l)||(c=l)}}await at(c);break;case"failed":case"completed":return i}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}};class an extends ce{}(function(r){r.VectorStoreFilesPage=an})(Vt||(Vt={}));class qt extends U{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return te(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,an,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(a.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const o=i.headers.get("openai-poll-after-ms");if(o){const l=parseInt(o);isNaN(l)||(c=l)}}await at(c);break;case"failed":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t===null||t.length==0)throw new Error("No files provided to process.");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,t.length),c=this._client,o=t.values(),l=[...n];async function h(b){for(let d of b){const f=await c.files.create({file:d,purpose:"assistants"},s);l.push(f.id)}}const m=Array(i).fill(o).map(h);return await $r(m),await this.createAndPoll(e,{file_ids:l})}}qt||(qt={});class Xt extends U{constructor(){super(...arguments),this.files=new Vt(this._client),this.fileBatches=new qt(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return te(e)?this.list({},e):this._client.getAPIList("/vector_stores",Fn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Fn extends ce{}(function(r){r.VectorStoresPage=Fn,r.Files=Vt,r.VectorStoreFilesPage=an,r.FileBatches=qt})(Xt||(Xt={}));class Ht extends U{constructor(){super(...arguments),this.vectorStores=new Xt(this._client),this.chat=new Nt(this._client),this.assistants=new Dt(this._client),this.threads=new Ut(this._client)}}(function(r){r.VectorStores=Xt,r.VectorStoresPage=Fn,r.Chat=Nt,r.Assistants=Dt,r.AssistantsPage=Tn,r.Threads=Ut})(Ht||(Ht={}));class Jt extends U{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Jt||(Jt={});class zt extends U{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}zt||(zt={});class Kt extends U{create(e,t){return this._client.post("/files",tt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return te(e)?this.list({},e):this._client.getAPIList("/files",Nn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await at(t),i=await this.retrieve(e),Date.now()-a>n)throw new Pn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}}class Nn extends Rn{}(function(r){r.FileObjectsPage=Nn})(Kt||(Kt={}));class Gt extends U{list(e,t={},n){return te(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Bn,{query:t,...n})}}class Bn extends ce{}(function(r){r.FineTuningJobCheckpointsPage=Bn})(Gt||(Gt={}));class Qt extends U{constructor(){super(...arguments),this.checkpoints=new Gt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return te(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",jn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return te(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ln,{query:t,...n})}}class jn extends ce{}class Ln extends ce{}(function(r){r.FineTuningJobsPage=jn,r.FineTuningJobEventsPage=Ln,r.Checkpoints=Gt,r.FineTuningJobCheckpointsPage=Bn})(Qt||(Qt={}));class Yt extends U{constructor(){super(...arguments),this.jobs=new Qt(this._client)}}(function(r){r.Jobs=Qt,r.FineTuningJobsPage=jn,r.FineTuningJobEventsPage=Ln})(Yt||(Yt={}));class Zt extends U{createVariation(e,t){return this._client.post("/images/variations",tt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",tt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Zt||(Zt={});class $t extends U{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Wn,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Wn extends Rn{}(function(r){r.ModelsPage=Wn})($t||($t={}));class en extends U{create(e,t){return this._client.post("/moderations",{body:e,...t})}}en||(en={});var ar;class H extends Lr{constructor({baseURL:e=ot("OPENAI_BASE_URL"),apiKey:t=ot("OPENAI_API_KEY"),organization:n=ot("OPENAI_ORG_ID")??null,project:s=ot("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new N("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&Qr())throw new N(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Jt(this),this.chat=new Pt(this),this.embeddings=new zt(this),this.files=new Kt(this),this.images=new Zt(this),this.audio=new Ot(this),this.moderations=new en(this),this.models=new $t(this),this.fineTuning=new Yt(this),this.beta=new Ht(this),this.batches=new Mt(this),this._options=i,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}ar=H;H.OpenAI=ar;H.OpenAIError=N;H.APIError=K;H.APIConnectionError=sn;H.APIConnectionTimeoutError=Pn;H.APIUserAbortError=ee;H.NotFoundError=Ws;H.ConflictError=Us;H.RateLimitError=qs;H.BadRequestError=Bs;H.AuthenticationError=js;H.InternalServerError=Xs;H.PermissionDeniedError=Ls;H.UnprocessableEntityError=Vs;H.toFile=Gs;H.fileFromPath=Fs;(function(r){r.Page=Rn,r.CursorPage=ce,r.Completions=Jt,r.Chat=Pt,r.Embeddings=zt,r.Files=Kt,r.FileObjectsPage=Nn,r.Images=Zt,r.Audio=Ot,r.Moderations=en,r.Models=$t,r.ModelsPage=Wn,r.FineTuning=Yt,r.Beta=Ht,r.Batches=Mt,r.BatchesPage=In})(H||(H={}));var ir={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.parse=void 0;function e(u){if(u!==void 0){if(u===null)return null;if(u==="")return"";try{return JSON.parse(u)}catch(_){const[p,v]=u.trimLeft()[0]===":"?t(u,_):t(u,_,b);return e.lastParseReminding=v,e.onExtraToken&&v.length>0&&e.onExtraToken(u,p,v),p}}}r.parse=e,function(u){u.onExtraToken=(_,p,v)=>{console.error("parsed json with extra tokens:",{text:_,data:p,reminding:v})}}(e=r.parse||(r.parse={}));function t(u,_,p){const v=s[u[0]]||p;if(!v)throw console.error(`no parser registered for ${JSON.stringify(u[0])}:`,{s:u}),_;return v(u,_)}function n(u,_,p){return u[0]==='"'?h(u):u[0]==="'"?m(u):b(u,_,p)}const s={};function a(u){return u.trimLeft()}s[" "]=i,s["\r"]=i,s[`
`]=i,s["	"]=i;function i(u,_){return u=a(u),t(u,_)}s["["]=c;function c(u,_){u=u.substr(1);const p=[];for(u=a(u);u.length>0;){if(u[0]==="]"){u=u.substr(1);break}const v=t(u,_,(P,E)=>b(P,E,[",","]"]));p.push(v[0]),u=v[1],u=a(u),u[0]===","&&(u=u.substring(1),u=a(u))}return[p,u]}for(const u of"0123456789.-".slice())s[u]=o;function o(u){for(let _=0;_<u.length;_++){const p=u[_];if(s[p]===o)continue;const v=u.substring(0,_);return u=u.substring(_),[l(v),u]}return[l(u),""]}function l(u){if(u==="-")return-0;const _=+u;return Number.isNaN(_)?u:_}s['"']=h;function h(u){for(let _=1;_<u.length;_++){const p=u[_];if(p==="\\"){_++;continue}if(p==='"'){const v=u.substring(0,_+1).replace(/\n/g,"\\n");return u=u.substring(_+1),[JSON.parse(v),u]}}return[JSON.parse(u+'"'),""]}s["'"]=m;function m(u){for(let _=1;_<u.length;_++){const p=u[_];if(p==="\\"){_++;continue}if(p==="'"){const v=u.substring(0,_+1).replace(/\n/g,"\\n");return u=u.substring(_+1),[JSON.parse('"'+v.slice(1,-1)+'"'),u]}}return[JSON.parse('"'+u.slice(1)+'"'),""]}function b(u,_,p=[" "]){const v=Math.min(...p.map(T=>{const O=u.indexOf(T);return O===-1?u.length:O})),P=u.substring(0,v).trim(),E=u.substring(v);return[P,E]}s["{"]=d;function d(u,_){u=u.substr(1);const p={};for(u=a(u);u.length>0;){if(u[0]==="}"){u=u.substr(1);break}const v=n(u,_,[":","}"]),P=v[0];if(u=v[1],u=a(u),u[0]!==":"){p[P]=void 0;break}if(u=u.substr(1),u=a(u),u.length===0){p[P]=void 0;break}const E=t(u,_);p[P]=E[0],u=E[1],u=a(u),u[0]===","&&(u=u.substr(1),u=a(u))}return[p,u]}s.t=f;function f(u,_){return y(u,"true",!0,_)}s.f=g;function g(u,_){return y(u,"false",!1,_)}s.n=S;function S(u,_){return y(u,"null",null,_)}function y(u,_,p,v){for(let P=_.length;P>=1;P--)if(u.startsWith(_.slice(0,P)))return[p,u.slice(P)];{const P=JSON.stringify(u.slice(0,_.length));throw console.error(`unknown token starting with ${P}:`,{s:u}),v}}})(ir);const ea=new H({apiKey:ht(ur),dangerouslyAllowBrowser:!0}),us=async r=>{var i,c;const e=`
  Your job is to help the user figure out which accounts they should open at a large financial institution.
  There are 43 different accounts to choose from and we will help the user.
  Based on their provided information:
  ${JSON.stringify(ht(z))}
  Your job is to ask them follow up questions that help determine which accounts they should open.
  Keep your questions friendly and professional.
  Keep your questions open ended and as brief as possible.
  Only ask one question at a time.
  Limit questions to 1-2 sentences MAX.
  Do not ask them about specific accounts, ask about their goals, it is your job to recommend accounts.
  If the user asks a question about any topic not related to their personal finance or account opening, please kindly re-direct the conversation
  Please continue asking questions until they've provided sufficient data to recommend an account
  Please generate JSON output in the format: {
    message: your message to the user;
    complete: (boolean) whether or not the user has provided sufficient data to recommend an account to open
  }
  `,t=r!==""?[{role:"system",content:e},...ht(Ae),{role:"user",content:r}]:[{role:"system",content:e},...ht(Ae)];console.log(t);const n=await ea.chat.completions.create({model:"gpt-4-turbo",response_format:{type:"json_object"},messages:t,stream:!0});let s="",a={message:"",complete:!1};Ae.update(o=>[...o,{role:"assistant",content:"..."}]);for await(const o of n)if(s+=((c=(i=o.choices[0])==null?void 0:i.delta)==null?void 0:c.content)||"",s.length>0)try{a=ir.parse(s),Ae.update(l=>[...l.slice(0,-1),{role:"assistant",content:a.message||"..."}])}catch(l){console.log("issue parsing - carry on!",l)}(a==null?void 0:a.complete)===!0&&_n.set(!0)};function hs(r,e,t){const n=r.slice();return n[14]=e[t].role,n[15]=e[t].content,n}function ds(r){let e,t,n='<h4 class="">Your Recommendations are Ready</h4> <button class="border-0">✕</button>',s,a,i,c=`Thank you for providing details about your finances! We are ready to provide you with
				recommendations. You may continue chatting with our assistant if you have additional
				questions or see your recommendations now!`,o,l,h,m="Keep Chatting",b,d,f="See Recommendations",g,S;return{c(){e=x("div"),t=x("div"),t.innerHTML=n,s=M(),a=x("div"),i=x("p"),i.textContent=c,o=M(),l=x("div"),h=x("button"),h.textContent=m,b=M(),d=x("button"),d.textContent=f,this.h()},l(y){e=k(y,"DIV",{class:!0});var u=R(e);t=k(u,"DIV",{class:!0,"data-svelte-h":!0}),L(t)!=="svelte-1czx6vq"&&(t.innerHTML=n),s=D(u),a=k(u,"DIV",{class:!0});var _=R(a);i=k(_,"P",{class:!0,"data-svelte-h":!0}),L(i)!=="svelte-1dcopo6"&&(i.textContent=c),o=D(_),l=k(_,"DIV",{class:!0});var p=R(l);h=k(p,"BUTTON",{class:!0,"data-svelte-h":!0}),L(h)!=="svelte-1ya41ei"&&(h.textContent=m),b=D(p),d=k(p,"BUTTON",{class:!0,"data-svelte-h":!0}),L(d)!=="svelte-18lsg1f"&&(d.textContent=f),p.forEach(A),_.forEach(A),u.forEach(A),this.h()},h(){C(t,"class","flex w-full items-center justify-between bg-fidelity-green-600 px-4 py-2 text-white"),C(i,"class","text-fidelity-neutral-600"),C(h,"class","bg-fidelity-neutral-100"),C(d,"class","bg-fidelity-green-600 text-white"),C(l,"class","flex w-full justify-end gap-2 pt-4"),C(a,"class","p-4"),C(e,"class","modal svelte-15e0aaj")},m(y,u){W(y,e,u),w(e,t),w(e,s),w(e,a),w(a,i),w(a,o),w(a,l),w(l,h),w(l,b),w(l,d),g||(S=[B(h,"click",r[8]),B(d,"click",r[6])],g=!0)},p:q,d(y){y&&A(e),g=!1,Re(S)}}}function ta(r){let e,t=r[15]+"",n;return{c(){e=x("div"),n=Q(t),this.h()},l(s){e=k(s,"DIV",{class:!0});var a=R(e);n=Y(a,t),a.forEach(A),this.h()},h(){C(e,"class","ml-auto w-4/5 rounded-lg bg-fidelity-green-600 p-2 text-white")},m(s,a){W(s,e,a),w(e,n)},p(s,a){a&8&&t!==(t=s[15]+"")&&Ue(n,t)},d(s){s&&A(e)}}}function na(r){let e,t,n=r[15]+"",s,a;return{c(){e=x("div"),t=x("div"),s=Q(n),a=M(),this.h()},l(i){e=k(i,"DIV",{class:!0});var c=R(e);t=k(c,"DIV",{class:!0});var o=R(t);s=Y(o,n),o.forEach(A),a=D(c),c.forEach(A),this.h()},h(){C(t,"class","rounded-lg bg-slate-200 p-2"),C(e,"class","w-4/5")},m(i,c){W(i,e,c),w(e,t),w(t,s),w(e,a)},p(i,c){c&8&&n!==(n=i[15]+"")&&Ue(s,n)},d(i){i&&A(e)}}}function fs(r){let e;function t(a,i){return a[14]==="assistant"?na:ta}let n=t(r),s=n(r);return{c(){s.c(),e=Le()},l(a){s.l(a),e=Le()},m(a,i){s.m(a,i),W(a,e,i)},p(a,i){n===(n=t(a))&&s?s.p(a,i):(s.d(1),s=n(a),s&&(s.c(),s.m(e.parentNode,e)))},d(a){a&&A(e),s.d(a)}}}function ms(r){let e,t="See the Results!";return{c(){e=x("button"),e.textContent=t,this.h()},l(n){e=k(n,"BUTTON",{class:!0,"data-svelte-h":!0}),L(e)!=="svelte-5efj3k"&&(e.textContent=t),this.h()},h(){C(e,"class","next float-right mt-4")},m(n,s){W(n,e,s)},d(n){n&&A(e)}}}function sa(r){let e,t,n,s,a,i,c,o,l,h=r[0]&&ds(r),m=ne(r[3]),b=[];for(let f=0;f<m.length;f+=1)b[f]=fs(hs(r,m,f));let d=r[4]&&ms();return{c(){h&&h.c(),e=M(),t=x("div"),n=x("div");for(let f=0;f<b.length;f+=1)b[f].c();s=M(),a=x("div"),i=x("textarea"),c=M(),d&&d.c(),this.h()},l(f){h&&h.l(f),e=D(f),t=k(f,"DIV",{class:!0});var g=R(t);n=k(g,"DIV",{class:!0});var S=R(n);for(let u=0;u<b.length;u+=1)b[u].l(S);S.forEach(A),s=D(g),a=k(g,"DIV",{class:!0});var y=R(a);i=k(y,"TEXTAREA",{class:!0,placeholder:!0}),R(i).forEach(A),c=D(y),d&&d.l(y),y.forEach(A),g.forEach(A),this.h()},h(){C(n,"class","mx-auto h-2/3 w-1/2 space-y-4 overflow-y-auto pb-6"),C(i,"class","h-full w-full resize-none rounded-lg p-1.5 text-sm outline-none ring-0"),C(i,"placeholder","Type a message..."),C(a,"class","mx-auto h-16 w-1/2"),C(t,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(f,g){h&&h.m(f,g),W(f,e,g),W(f,t,g),w(t,n);for(let S=0;S<b.length;S+=1)b[S]&&b[S].m(n,null);r[9](n),w(t,s),w(t,a),w(a,i),r[10](i),w(a,c),d&&d.m(a,null),o||(l=B(i,"keydown",r[11]),o=!0)},p(f,[g]){if(f[0]?h?h.p(f,g):(h=ds(f),h.c(),h.m(e.parentNode,e)):h&&(h.d(1),h=null),g&8){m=ne(f[3]);let S;for(S=0;S<m.length;S+=1){const y=hs(f,m,S);b[S]?b[S].p(y,g):(b[S]=fs(y),b[S].c(),b[S].m(n,null))}for(;S<b.length;S+=1)b[S].d(1);b.length=m.length}f[4]?d||(d=ms(),d.c(),d.m(a,null)):d&&(d.d(1),d=null)},i:q,o:q,d(f){f&&(A(e),A(t)),h&&h.d(f),We(b,f),r[9](null),r[10](null),d&&d.d(),o=!1,l()}}}function ra(r,e,t){let n,s,a;fe(r,Ae,y=>t(3,n=y)),fe(r,z,y=>t(12,s=y)),fe(r,_n,y=>t(4,a=y));let{onNext:i=()=>{}}=e,c=!1,o,l;xe(async()=>{console.log(s),await us("Please briefly but kindly greet the current user by name and then ask the first question"),Ae.subscribe(y=>{setTimeout(()=>{l&&t(2,l.scrollTop=l.scrollHeight,l)},10)}),_n.subscribe(y=>{y===!0&&t(0,c=!0)}),o&&o.focus()});const h=()=>{Ae.update(y=>[...y,{role:"user",content:o.value}]),t(1,o.value="",o),o.focus(),us("")},m=y=>{y.key==="Enter"&&(y.preventDefault(),h())},b=()=>{z.update(y=>(y.messages=n,y)),i()},d=()=>{t(0,c=!1)};function f(y){je[y?"unshift":"push"](()=>{l=y,t(2,l)})}function g(y){je[y?"unshift":"push"](()=>{o=y,t(1,o)})}const S=y=>m(y);return r.$$set=y=>{"onNext"in y&&t(7,i=y.onNext)},[c,o,l,n,a,m,b,i,d,f,g,S]}class aa extends ge{constructor(e){super(),_e(this,e,ra,sa,me,{onNext:7})}}function ia(r){let e,t,n,s="What's your email?",a,i,c="We'll use this to save your results, so you can see them later",o,l,h,m,b,d="Back",f,g,S,y,u;return{c(){e=x("div"),t=x("div"),n=x("h1"),n.textContent=s,a=M(),i=x("p"),i.textContent=c,o=M(),l=x("textarea"),h=M(),m=x("div"),b=x("button"),b.textContent=d,f=M(),g=x("button"),S=Q("Next"),this.h()},l(_){e=k(_,"DIV",{class:!0});var p=R(e);t=k(p,"DIV",{class:!0});var v=R(t);n=k(v,"H1",{class:!0,"data-svelte-h":!0}),L(n)!=="svelte-17nzind"&&(n.textContent=s),a=D(v),i=k(v,"P",{class:!0,"data-svelte-h":!0}),L(i)!=="svelte-trs68f"&&(i.textContent=c),o=D(v),l=k(v,"TEXTAREA",{rows:!0,class:!0}),R(l).forEach(A),h=D(v),m=k(v,"DIV",{class:!0});var P=R(m);b=k(P,"BUTTON",{class:!0,"data-svelte-h":!0}),L(b)!=="svelte-1admezx"&&(b.textContent=d),f=D(P),g=k(P,"BUTTON",{class:!0});var E=R(g);S=Y(E,"Next"),E.forEach(A),P.forEach(A),v.forEach(A),p.forEach(A),this.h()},h(){C(n,"class","font-light"),C(i,"class","text-fidelity-neutral-500 my-3"),C(l,"rows","1"),C(l,"class","svelte-zdeguy"),C(b,"class","back"),C(g,"class","next"),g.disabled=r[5],C(m,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),C(t,"class","w-96 h-1/2 mx-auto text-center"),C(e,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(_,p){W(_,e,p),w(e,t),w(t,n),w(t,a),w(t,i),w(t,o),w(t,l),r[7](l),Ce(l,r[3].email),w(t,h),w(t,m),w(m,b),w(m,f),w(m,g),w(g,S),y||(u=[B(l,"input",r[8]),B(l,"keydown",r[9]),B(b,"click",r[10]),B(g,"click",r[11])],y=!0)},p(_,[p]){p&8&&Ce(l,_[3].email),p&32&&(g.disabled=_[5])},i:q,o:q,d(_){_&&A(e),r[7](null),y=!1,Re(u)}}}function la(r,e,t){let n,s;fe(r,z,g=>t(3,s=g));let{back:a}=e,{next:i}=e,{changeStep:c=g=>{}}=e,o;xe(()=>{ye.set(!0),console.log(s),o==null||o.focus(),window.scrollTo(0,0)});const l=g=>{console.log(n),g.key==="Enter"&&(g.preventDefault(),c(i))};function h(g){je[g?"unshift":"push"](()=>{o=g,t(4,o)})}function m(){s.email=this.value,z.set(s)}const b=g=>l(g),d=()=>c(a),f=()=>c(i);return r.$$set=g=>{"back"in g&&t(0,a=g.back),"next"in g&&t(1,i=g.next),"changeStep"in g&&t(2,c=g.changeStep)},r.$$.update=()=>{r.$$.dirty&8&&t(5,n=s.email?s.email.length<=4:!0)},[a,i,c,s,o,n,l,h,m,b,d,f]}class oa extends ge{constructor(e){super(),_e(this,e,la,ia,me,{back:0,next:1,changeStep:2})}}function ca(r){let e,t,n,s="Create your Fidelity Password?",a,i,c="Please choose at least 8 characters, including letters and numbers",o,l,h,m,b,d="Back",f,g,S,y,u;return{c(){e=x("div"),t=x("div"),n=x("h1"),n.textContent=s,a=M(),i=x("p"),i.textContent=c,o=M(),l=x("textarea"),h=M(),m=x("div"),b=x("button"),b.textContent=d,f=M(),g=x("button"),S=Q("Next"),this.h()},l(_){e=k(_,"DIV",{class:!0});var p=R(e);t=k(p,"DIV",{class:!0});var v=R(t);n=k(v,"H1",{class:!0,"data-svelte-h":!0}),L(n)!=="svelte-1shi0ru"&&(n.textContent=s),a=D(v),i=k(v,"P",{class:!0,"data-svelte-h":!0}),L(i)!=="svelte-hluucs"&&(i.textContent=c),o=D(v),l=k(v,"TEXTAREA",{class:!0,rows:!0}),R(l).forEach(A),h=D(v),m=k(v,"DIV",{class:!0});var P=R(m);b=k(P,"BUTTON",{class:!0,"data-svelte-h":!0}),L(b)!=="svelte-1admezx"&&(b.textContent=d),f=D(P),g=k(P,"BUTTON",{class:!0});var E=R(g);S=Y(E,"Next"),E.forEach(A),P.forEach(A),v.forEach(A),p.forEach(A),this.h()},h(){C(n,"class","font-light"),C(i,"class","text-fidelity-neutral-500 my-3"),C(l,"class","single svelte-x99d95"),C(l,"rows","1"),C(b,"class","back"),C(g,"class","next"),g.disabled=r[5],C(m,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),C(t,"class","w-96 h-1/2 mx-auto text-center"),C(e,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(_,p){W(_,e,p),w(e,t),w(t,n),w(t,a),w(t,i),w(t,o),w(t,l),r[7](l),Ce(l,r[3].password),w(t,h),w(t,m),w(m,b),w(m,f),w(m,g),w(g,S),y||(u=[B(l,"input",r[8]),B(l,"keydown",r[9]),B(b,"click",r[10]),B(g,"click",r[11])],y=!0)},p(_,[p]){p&8&&Ce(l,_[3].password),p&32&&(g.disabled=_[5])},i:q,o:q,d(_){_&&A(e),r[7](null),y=!1,Re(u)}}}function ua(r,e,t){let n,s;fe(r,z,g=>t(3,s=g));let{back:a=""}=e,{next:i=""}=e,{changeStep:c=g=>{}}=e,o;xe(()=>{ye.set(!0),console.log(s),o==null||o.focus(),window.scrollTo(0,0)});const l=g=>{console.log(n),g.key==="Enter"&&(g.preventDefault(),c(i))};function h(g){je[g?"unshift":"push"](()=>{o=g,t(4,o)})}function m(){s.password=this.value,z.set(s)}const b=g=>l(g),d=()=>c(a),f=()=>c(i);return r.$$set=g=>{"back"in g&&t(0,a=g.back),"next"in g&&t(1,i=g.next),"changeStep"in g&&t(2,c=g.changeStep)},r.$$.update=()=>{r.$$.dirty&8&&t(5,n=s.password?s.password.length<=4:!0)},[a,i,c,s,o,n,l,h,m,b,d,f]}class ha extends ge{constructor(e){super(),_e(this,e,ua,ca,me,{back:0,next:1,changeStep:2})}}function gs(r,e,t){const n=r.slice();return n[17]=e[t],n[19]=t,n}function _s(r){let e,t=ne(r[5]),n=[];for(let s=0;s<t.length;s+=1)n[s]=ps(gs(r,t,s));return{c(){e=x("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=k(s,"DIV",{class:!0});var a=R(e);for(let i=0;i<n.length;i+=1)n[i].l(a);a.forEach(A),this.h()},h(){C(e,"class","absolute top-[68px] w-full border-[1px] bg-white text-sm text-fidelity-neutral-600")},m(s,a){W(s,e,a);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,a){if(a&352){t=ne(s[5]);let i;for(i=0;i<t.length;i+=1){const c=gs(s,t,i);n[i]?n[i].p(c,a):(n[i]=ps(c),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(s){s&&A(e),We(n,s)}}}function ps(r){let e,t=r[17]+"",n,s,a,i;function c(){return r[13](r[19])}return{c(){e=x("button"),n=Q(t),s=M(),this.h()},l(o){e=k(o,"BUTTON",{class:!0,style:!0});var l=R(e);n=Y(l,t),s=D(l),l.forEach(A),this.h()},h(){C(e,"class","w-full text-left p-2 border-fidelity-neutral-200 cursor-pointer rounded-none hover:bg-fidelity-neutral-200"),qn(e,"background-color",r[6]===r[19]?"rgb(230 228 225)":"")},m(o,l){W(o,e,l),w(e,n),w(e,s),a||(i=B(e,"click",c),a=!0)},p(o,l){r=o,l&32&&t!==(t=r[17]+"")&&Ue(n,t),l&64&&qn(e,"background-color",r[6]===r[19]?"rgb(230 228 225)":"")},d(o){o&&A(e),a=!1,i()}}}function da(r){let e,t,n,s="What's your Address?",a,i,c="This will help us give you personalized tax and financial guidance",o,l,h,m,b,d,f,g="Back",S,y,u,_,p,v=r[5].length>0&&_s(r);return{c(){e=x("div"),t=x("div"),n=x("h1"),n.textContent=s,a=M(),i=x("p"),i.textContent=c,o=M(),l=x("div"),h=x("textarea"),m=M(),v&&v.c(),b=M(),d=x("div"),f=x("button"),f.textContent=g,S=M(),y=x("button"),u=Q("Next"),this.h()},l(P){e=k(P,"DIV",{class:!0});var E=R(e);t=k(E,"DIV",{class:!0});var T=R(t);n=k(T,"H1",{class:!0,"data-svelte-h":!0}),L(n)!=="svelte-23if35"&&(n.textContent=s),a=D(T),i=k(T,"P",{class:!0,"data-svelte-h":!0}),L(i)!=="svelte-1hhgmn0"&&(i.textContent=c),o=D(T),l=k(T,"DIV",{class:!0});var O=R(l);h=k(O,"TEXTAREA",{class:!0,rows:!0}),R(h).forEach(A),m=D(O),v&&v.l(O),O.forEach(A),b=D(T),d=k(T,"DIV",{class:!0});var X=R(d);f=k(X,"BUTTON",{class:!0,"data-svelte-h":!0}),L(f)!=="svelte-1admezx"&&(f.textContent=g),S=D(X),y=k(X,"BUTTON",{class:!0});var j=R(y);u=Y(j,"Next"),j.forEach(A),X.forEach(A),T.forEach(A),E.forEach(A),this.h()},h(){C(n,"class","font-light"),C(i,"class","text-fidelity-neutral-500 my-3"),C(h,"class"," svelte-nz8rex"),C(h,"rows","1"),C(l,"class","relative"),C(f,"class","back"),C(y,"class","next"),y.disabled=r[7],C(d,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),C(t,"class","w-96 h-1/2 mx-auto"),C(e,"class","h-[calc(100vh-112px)] pt-[10vh]")},m(P,E){W(P,e,E),w(e,t),w(t,n),w(t,a),w(t,i),w(t,o),w(t,l),w(l,h),r[10](h),Ce(h,r[3].address),w(l,m),v&&v.m(l,null),w(t,b),w(t,d),w(d,f),w(d,S),w(d,y),w(y,u),_||(p=[B(h,"input",r[11]),B(h,"keyup",r[12]),B(h,"keydown",ma),B(f,"click",r[14]),B(y,"click",r[15])],_=!0)},p(P,[E]){E&8&&Ce(h,P[3].address),P[5].length>0?v?v.p(P,E):(v=_s(P),v.c(),v.m(l,null)):v&&(v.d(1),v=null),E&128&&(y.disabled=P[7])},i:q,o:q,d(P){P&&A(e),r[10](null),v&&v.d(),_=!1,Re(p)}}}const fa="fc57a396dfef452cb85db04e17831c49",ma=r=>r.key==="Enter"&&r.preventDefault();function ga(r,e,t){let n,s;fe(r,z,p=>t(3,s=p));let a,{back:i}=e,{next:c}=e,{changeStep:o=p=>{}}=e,l=new AbortController;xe(()=>{ye.set(!0),a.focus(),window.scrollTo(0,0)});let h=[],m=0;const b=p=>{t(4,a.value=h[p],a),z.set({...s,address:h[p]}),t(5,h=[]),a.focus()},d=p=>{const v=a.value.trim(),P=`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(v+" USA")}&lang=en&limit=5&format=json&apiKey=${fa}`;if(p.key==="Enter"&&h.length>0){t(4,a.value=h[m],a),z.set({...s,address:h[m]}),t(5,h=[]),a.focus(),console.log(s.address);return}if(p.key==="Enter"&&o(c),p.key==="ArrowDown"){console.log("Scroll Down"),t(6,m=m===h.length-1?0:m+1);return}if(p.key==="ArrowUp"){console.log("Scroll Up"),t(6,m=m===0?h.length-1:m-1);return}v.length>5?(l.abort(),l=new AbortController,fetch(P,{signal:l.signal}).then(E=>{if(!E.ok)throw new Error("Network response was not ok");return E.json()}).then(E=>{console.log(E),t(5,h=E.results.map(T=>T.formatted.replace(", United States of America","")))}).catch(E=>{E.name!=="AbortError"&&console.error("Fetch error:",E)})):t(5,h=[])};function f(p){je[p?"unshift":"push"](()=>{a=p,t(4,a)})}function g(){s.address=this.value,z.set(s)}const S=p=>d(p),y=p=>b(p),u=()=>o(i),_=()=>o(c);return r.$$set=p=>{"back"in p&&t(0,i=p.back),"next"in p&&t(1,c=p.next),"changeStep"in p&&t(2,o=p.changeStep)},r.$$.update=()=>{r.$$.dirty&8&&t(7,n=!s.address||s.address.length<=20)},[i,c,o,s,a,h,m,n,b,d,f,g,S,y,u,_]}class _a extends ge{constructor(e){super(),_e(this,e,ga,da,me,{back:0,next:1,changeStep:2})}}function ws(r,e,t){const n=r.slice();return n[7]=e[t],n[9]=t,n}function bs(r){let e,t=ne(r[0]),n=[];for(let s=0;s<t.length;s+=1)n[s]=ys(ws(r,t,s));return{c(){e=x("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){e=k(s,"DIV",{class:!0});var a=R(e);for(let i=0;i<n.length;i+=1)n[i].l(a);a.forEach(A),this.h()},h(){C(e,"class","mx-auto flex h-24 flex-row items-center justify-center gap-3")},m(s,a){W(s,e,a);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null)},p(s,a){if(a&23){t=ne(s[0]);let i;for(i=0;i<t.length;i+=1){const c=ws(s,t,i);n[i]?n[i].p(c,a):(n[i]=ys(c),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(s){s&&A(e),We(n,s)}}}function ys(r){let e,t=r[9]+1+"",n,s,a,i,c;function o(){return r[6](r[9])}return{c(){e=x("button"),n=Q(t),s=M(),this.h()},l(l){e=k(l,"BUTTON",{class:!0});var h=R(e);n=Y(h,t),s=D(h),h.forEach(A),this.h()},h(){C(e,"class",a="circle "+(r[9]===r[1]?"current":r[9]<=r[2]?"last":"future")+" svelte-3sjztk")},m(l,h){W(l,e,h),w(e,n),w(e,s),i||(c=B(e,"click",o),i=!0)},p(l,h){r=l,h&6&&a!==(a="circle "+(r[9]===r[1]?"current":r[9]<=r[2]?"last":"future")+" svelte-3sjztk")&&C(e,"class",a)},d(l){l&&A(e),i=!1,c()}}}function pa(r){let e,t=r[3]&&bs(r);return{c(){t&&t.c(),e=Le()},l(n){t&&t.l(n),e=Le()},m(n,s){t&&t.m(n,s),W(n,e,s)},p(n,[s]){n[3]?t?t.p(n,s):(t=bs(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:q,o:q,d(n){n&&A(e),t&&t.d(n)}}}function wa(r,e,t){let n;fe(r,ye,h=>t(3,n=h));let{steps:s=[]}=e,{displayedStep:a=-1}=e,{maxStep:i=0}=e,{changeStep:c=h=>{}}=e;const o=h=>{h>i||h===a||c(h)},l=h=>o(h);return r.$$set=h=>{"steps"in h&&t(0,s=h.steps),"displayedStep"in h&&t(1,a=h.displayedStep),"maxStep"in h&&t(2,i=h.maxStep),"changeStep"in h&&t(5,c=h.changeStep)},[s,a,i,n,o,c,l]}class ba extends ge{constructor(e){super(),_e(this,e,wa,pa,me,{steps:0,displayedStep:1,maxStep:2,changeStep:5})}}function vs(r,e,t){const n=r.slice();return n[10]=e[t],n[12]=t,n}function Ss(r){let e,t=r[10].label+"",n,s,a,i;function c(){return r[7](r[12])}return{c(){e=x("button"),n=Q(t),s=M(),this.h()},l(o){e=k(o,"BUTTON",{class:!0});var l=R(e);n=Y(l,t),s=D(l),l.forEach(A),this.h()},h(){C(e,"class","grid"),kt(e,"selected",r[10].status)},m(o,l){W(o,e,l),w(e,n),w(e,s),a||(i=B(e,"click",c),a=!0)},p(o,l){r=o,l&8&&t!==(t=r[10].label+"")&&Ue(n,t),l&8&&kt(e,"selected",r[10].status)},d(o){o&&A(e),a=!1,i()}}}function ya(r){let e,t,n,s="Investments",a,i,c="Tell me what investments you currently have",o,l,h,m,b,d="Back",f,g,S,y,u,_=ne(r[3]),p=[];for(let v=0;v<_.length;v+=1)p[v]=Ss(vs(r,_,v));return{c(){e=x("div"),t=x("div"),n=x("h1"),n.textContent=s,a=M(),i=x("p"),i.textContent=c,o=M(),l=x("div");for(let v=0;v<p.length;v+=1)p[v].c();h=M(),m=x("div"),b=x("button"),b.textContent=d,f=M(),g=x("button"),S=Q("Next"),this.h()},l(v){e=k(v,"DIV",{class:!0});var P=R(e);t=k(P,"DIV",{class:!0});var E=R(t);n=k(E,"H1",{class:!0,"data-svelte-h":!0}),L(n)!=="svelte-udh2j9"&&(n.textContent=s),a=D(E),i=k(E,"P",{class:!0,"data-svelte-h":!0}),L(i)!=="svelte-1t4kldk"&&(i.textContent=c),o=D(E),l=k(E,"DIV",{class:!0});var T=R(l);for(let j=0;j<p.length;j+=1)p[j].l(T);T.forEach(A),h=D(E),m=k(E,"DIV",{class:!0});var O=R(m);b=k(O,"BUTTON",{class:!0,"data-svelte-h":!0}),L(b)!=="svelte-1admezx"&&(b.textContent=d),f=D(O),g=k(O,"BUTTON",{class:!0});var X=R(g);S=Y(X,"Next"),X.forEach(A),O.forEach(A),E.forEach(A),P.forEach(A),this.h()},h(){C(n,"class","font-light"),C(i,"class","text-fidelity-neutral-500 my-8"),C(l,"class","flex justify-center items-center flex-wrap gap-4"),C(b,"class","back"),C(g,"class","next"),g.disabled=r[4],C(m,"class","grid grid-cols-2 w-3/4 mx-auto pt-8 gap-4"),C(t,"class","w-96 h-1/2 mx-auto text-center"),C(e,"class","h-[calc(100vh-112px)] pt-[5vh]")},m(v,P){W(v,e,P),w(e,t),w(t,n),w(t,a),w(t,i),w(t,o),w(t,l);for(let E=0;E<p.length;E+=1)p[E]&&p[E].m(l,null);w(t,h),w(t,m),w(m,b),w(m,f),w(m,g),w(g,S),y||(u=[B(b,"click",r[8]),B(g,"click",r[9])],y=!0)},p(v,[P]){if(P&40){_=ne(v[3]);let E;for(E=0;E<_.length;E+=1){const T=vs(v,_,E);p[E]?p[E].p(T,P):(p[E]=Ss(T),p[E].c(),p[E].m(l,null))}for(;E<p.length;E+=1)p[E].d(1);p.length=_.length}P&16&&(g.disabled=v[4])},i:q,o:q,d(v){v&&A(e),We(p,v),y=!1,Re(u)}}}function va(r,e,t){let n,s;fe(r,z,d=>t(6,s=d));let{back:a}=e,{next:i}=e,{changeStep:c=d=>{}}=e,o=[{label:"401k",status:0},{label:"Traditional / Roth IRA",status:0},{label:"Crypto Currency",status:0},{label:"Stocks",status:0},{label:"Bonds",status:0},{label:"Mortgage",status:0}].map(d=>({label:d.label,status:s.investments&&s.investments.includes(d.label)?1:0}));xe(()=>{ye.set(!0),console.log(s),window.scrollTo(0,0)});const l=d=>{t(3,o=o.map((f,g)=>d===g?{...f,status:f.status?0:1}:f)),z.update(f=>(f.investments=o.filter(g=>g.status).map(g=>g.label),f))},h=d=>l(d),m=()=>c(a),b=()=>c(i);return r.$$set=d=>{"back"in d&&t(0,a=d.back),"next"in d&&t(1,i=d.next),"changeStep"in d&&t(2,c=d.changeStep)},r.$$.update=()=>{r.$$.dirty&64&&t(4,n=!s.investments||s.investments.length===0)},[a,i,c,o,n,l,s,h,m,b]}class Sa extends ge{constructor(e){super(),_e(this,e,va,ya,me,{back:0,next:1,changeStep:2})}}function Cs(r,e,t){const n=r.slice();return n[6]=e[t],n[8]=t,n}function xs(r){let e,t,n,s,a,i;var c=r[4][r[8]];function o(l,h){return{props:{back:l[8]-1,next:l[8]+1,changeStep:l[5]}}}return c&&(t=Xn(c,o(r))),{c(){e=x("div"),t&&fn(t.$$.fragment),n=M(),this.h()},l(l){e=k(l,"DIV",{class:!0});var h=R(e);t&&Rs(t.$$.fragment,h),n=D(h),h.forEach(A),this.h()},h(){C(e,"class","h-full w-full")},m(l,h){W(l,e,h),t&&mn(t,e,null),w(e,n),i=!0},p(l,h){if(c!==(c=l[4][l[8]])){if(t){tn();const m=t;be(m.$$.fragment,1,0,()=>{gn(m,1)}),nn()}c?(t=Xn(c,o(l)),fn(t.$$.fragment),le(t.$$.fragment,1),mn(t,e,n)):t=null}},i(l){i||(t&&le(t.$$.fragment,l),l&&As(()=>{i&&(a&&a.end(1),s=Es(e,At,{duration:300}),s.start())}),i=!0)},o(l){t&&be(t.$$.fragment,l),s&&s.invalidate(),l&&(a=Ps(e,At,{duration:300})),i=!1},d(l){l&&A(e),t&&gn(t),l&&a&&a.end()}}}function ks(r){let e,t,n=r[8]===r[1]&&xs(r);return{c(){n&&n.c(),e=Le()},l(s){n&&n.l(s),e=Le()},m(s,a){n&&n.m(s,a),W(s,e,a),t=!0},p(s,a){s[8]===s[1]?n?(n.p(s,a),a&2&&le(n,1)):(n=xs(s),n.c(),le(n,1),n.m(e.parentNode,e)):n&&(tn(),be(n,1,1,()=>{n=null}),nn())},i(s){t||(le(n),t=!0)},o(s){be(n),t=!1},d(s){s&&A(e),n&&n.d(s)}}}function Ca(r){let e,t,n,s;t=new ba({props:{steps:r[3],displayedStep:r[2],maxStep:r[0],changeStep:r[5]}});let a=ne(r[3]),i=[];for(let o=0;o<a.length;o+=1)i[o]=ks(Cs(r,a,o));const c=o=>be(i[o],1,1,()=>{i[o]=null});return{c(){e=x("div"),fn(t.$$.fragment),n=M();for(let o=0;o<i.length;o+=1)i[o].c();this.h()},l(o){e=k(o,"DIV",{class:!0});var l=R(e);Rs(t.$$.fragment,l),n=D(l);for(let h=0;h<i.length;h+=1)i[h].l(l);l.forEach(A),this.h()},h(){C(e,"class","w-full bg-fidelity-neutral-50")},m(o,l){W(o,e,l),mn(t,e,null),w(e,n);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(e,null);s=!0},p(o,[l]){const h={};if(l&4&&(h.displayedStep=o[2]),l&1&&(h.maxStep=o[0]),t.$set(h),l&50){a=ne(o[3]);let m;for(m=0;m<a.length;m+=1){const b=Cs(o,a,m);i[m]?(i[m].p(b,l),le(i[m],1)):(i[m]=ks(b),i[m].c(),le(i[m],1),i[m].m(e,null))}for(tn(),m=a.length;m<i.length;m+=1)c(m);nn()}},i(o){if(!s){le(t.$$.fragment,o);for(let l=0;l<a.length;l+=1)le(i[l]);s=!0}},o(o){be(t.$$.fragment,o),i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)be(i[l]);s=!1},d(o){o&&A(e),gn(t),We(i,o)}}}function xa(r,e,t){const n=["Intro","Goals","Name","Email","Password","Address","Investments","Chat"],s=[fr,_r,Sr,oa,ha,_a,Sa,aa];let a=0,i=0,c=0;async function o(l){console.log(i,l),t(1,i=-1),await or(),setTimeout(()=>{t(1,i=l),t(2,c=l),l>=a&&t(0,a=l),console.log(i,a)},300)}return[a,i,c,n,s,o]}class La extends ge{constructor(e){super(),_e(this,e,xa,Ca,me,{})}}export{La as component};
